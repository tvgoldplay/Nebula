# This file contains common pin mappings for the BIGTREETECH Octopus Max EZ.
# To use this config, the firmware should be compiled for the
# STM32H723 with a "128KiB bootloader", "25 MHz crystal",
# and one of:
# Communication interface: "USB (on PA11/PA12)",
# Communication interface: "CAN bus (on PD0/PD1)", or
# Communication interface: "USB to CAN bus bridge (USB on PA11/PA12))" and CAN bus interface: "CAN bus (on PD0/PD1)".

# See docs/Config_Reference.md for a description of parameters.

#=====================================================
# MACROS
#=====================================================
[include macros.cfg]
[include Fan.cfg]
[include TMC Autotune.cfg]
[exclude_object]
[include TEST_SPEED.cfg]
[include timelapse.cfg]
[include temp_sensors.cfg]
[include z_tilt.cfg]
[include beacon.cfg]
[include LED.cfg]
[include resonance_tester.cfg]
[include input_shaper.cfg]
[include AFC/*.cfg]
#====================================================0=
# VIRTUAL SD CARD
#=====================================================
[include mainsail.cfg]
[virtual_sdcard]
path: /home/pi/printer_data/gcodes

#=====================================================
# MCU ID
#=====================================================
[mcu]
serial: /dev/serial/by-id/usb-Klipper_stm32h723xx_3F003D001051313236343430-if00
[mcu EBBCan]
canbus_uuid: e75929009724
[mcu U2C]
canbus_uuid: 2246f0775ddc

####################################################################
# 	X/Y Stepper Settings
#####################################################################

########################################
# X Stepper on Motor1 (A Motor)
########################################
# Motor-1
[stepper_a]
step_pin: PC13
dir_pin: PC14
enable_pin: !PE6
microsteps: 16
rotation_distance: 40
endstop_pin: EBBCan:PB5
position_endstop: 1
position_max: 377
homing_speed: 150

[tmc5160 stepper_a]
cs_pin: PG14
spi_software_mosi_pin: PE14
spi_software_miso_pin: PE13
spi_software_sclk_pin: PE12
run_current: 1.4
interpolate: false
sense_resistor: 0.075

########################################
# Y Stepper on Motor2 (B Motor)
########################################
# Motor-2
[stepper_b]
step_pin: PE4
dir_pin: PE5
enable_pin: !PE3
microsteps: 16
rotation_distance: 40
endstop_pin: PF0
position_endstop: 370
position_max: 370
homing_speed: 150

[tmc5160 stepper_b]
cs_pin: PG13
spi_software_mosi_pin: PE14
spi_software_miso_pin: PE13
spi_software_sclk_pin: PE12
run_current: 1.4
interpolate: false
sense_resistor: 0.075

########################################
# C Stepper on Motor3 (C Motor)
########################################

[stepper_c]
step_pin: PE1
dir_pin: !PE0
enable_pin: !PE2
microsteps: 16
rotation_distance: 40
position_endstop: 370
position_max: 370
endstop_pin: PF4
homing_speed: 150

[tmc5160 stepper_c]
cs_pin: PG12
spi_software_mosi_pin: PE14
spi_software_miso_pin: PE13
spi_software_sclk_pin: PE12
run_current: 1.4
sense_resistor: 0.075
interpolate: false

########################################
# C1 Stepper on Motor4 (C1 Motor)
########################################

[stepper_c1]
step_pin: PB8
dir_pin: PB9
enable_pin: !PB7
microsteps: 16
rotation_distance: 40

[tmc5160 stepper_c1]
cs_pin: PG11
spi_software_mosi_pin: PE14
spi_software_miso_pin: PE13
spi_software_sclk_pin: PE12
run_current: 1.4
sense_resistor: 0.075
interpolate: false

########################################
# STEPPER Z
########################################
# Motor-5 Front Left
[stepper_z]
step_pin: PB5
dir_pin: PB4
enable_pin: !PB6
endstop_pin: probe:z_virtual_endstop
microsteps: 16
full_steps_per_rotation: 200
rotation_distance: 2
position_max: 395
position_min: -4
homing_speed: 10
homing_retract_dist: 0

[tmc2209 stepper_z]
interpolate: false
uart_pin: PG10
run_current: 1.0
sense_resistor: 0.11


# Motor-6 Front Right 
[stepper_z1] 
step_pin: PG15
dir_pin: PB3
enable_pin: !PD5
microsteps: 16
full_steps_per_rotation: 200
rotation_distance: 2

[tmc2209 stepper_z1]
interpolate: false
uart_pin: PG9
run_current: 1.0
sense_resistor: 0.11

# motor-7 Rear center
[stepper_z2]
step_pin:PD3
dir_pin: PD2
enable_pin: !PD4
microsteps: 16
full_steps_per_rotation: 200
rotation_distance: 2

[tmc2209 stepper_z2]
interpolate: false
uart_pin: PD7
run_current: 1.0
sense_resistor: 0.11

########################################
# EXTRUDER
########################################
[extruder]
step_pin: EBBCan: PD0
dir_pin: !EBBCan: PD1
enable_pin: !EBBCan: PD2
microsteps: 16
rotation_distance: 35.1
gear_ratio: 60:10
nozzle_diameter: 0.400
filament_diameter: 1.750
heater_pin: EBBCan: PB13
sensor_type: MAX31865
pwm_cycle_time: 0.00417
sensor_pin: EBBCan: PA4
spi_bus: spi1
rtd_nominal_r: 100
rtd_reference_r: 430
rtd_num_of_wires: 2
min_extrude_temp: 180
min_temp: 0
max_temp: 400
#control: pid
#pid_Kp: 21.527
#pid_Ki: 1.063
#pid_Kd: 108.982
full_steps_per_rotation: 200
pressure_advance: 0.031
pressure_advance_smooth_time: 0.02
max_extrude_only_distance: 400 

[tmc2209 extruder]
uart_pin: EBBCan: PA15
interpolate: false
run_current: 0.85 
sense_resistor: 0.11 

########################################
# BED MESH
########################################
[bed_mesh]
algorithm: bicubic
speed: 500
mesh_min: 50,50
mesh_max: 330,330
probe_count: 25,25

########################################
# IDLE TIMEOUT
########################################
[idle_timeout]
timeout: 172800

########################################
# HEATER BED
########################################
[heater_bed]
heater_pin: PA0
sensor_pin: PB1 # TB
sensor_type: EPCOS 100K B57560G104F
#control: pid
#pid_kp: 27
#pid_ki: 0.08
#pid_kd: 0
min_temp: 0
max_temp: 120

#=====================================================
# Force Move
#=====================================================
[force_move]
enable_force_move: True

#=====================================================
# PRINTER LIMITS
#=====================================================
[printer]
kinematics: extended_corexy
home_y_axis_with_b_rail : True
max_velocity: 800
max_accel: 10000
max_z_velocity: 10
max_z_accel: 300
square_corner_velocity: 5.0

#[skew_correction]

#=====================================================
# SHAKETUNE
#=====================================================
[shaketune]
# result_folder: ~/printer_data/config/ShakeTune_results
#    Path where the processed results will be stored. If the folder doesn't exist,
#    it will be automatically created. You can change this if you'd like to store 
#    results in a different location.
# number_of_results_to_keep: 10
#    This setting defines how many results you want to keep in the result folder.
#    Once the specified number is exceeded, older results will be automatically deleted
#    to free up space on the SD card and avoid cluttering the results folder.
# keep_raw_data: False
#    If set to True, Shake&Tune will store both the processed graphs and the raw accelerometer
#    .stdata files in the results folder. This can be useful for debugging or archiving purposes.
#    Please always attach them when reporting any issues on GitHub or Discord.
# show_macros_in_webui: True
#    Mainsail and Fluidd doesn't create buttons for system commands (macros that are not part
#    of the printer.cfg file). This option allow Shake&Tune to inject them into the webui at runtime.
#    If set to False, the macros will be hidden but still accessible from the console by typing
#    their names manually, which can be useful if you prefer to encapsulate them into your own macros.
# timeout: 600
#    This defines the maximum processing time (in seconds) to allows to Shake&Tune for generating 
#    graphs from a .stdata file. 10 minutes should be more than enough in most cases, but if you have
#    slower hardware (e.g., older SD cards or low-performance devices), increase it to prevent timeouts.
# measurements_chunk_size: 2
#    Each Shake&Tune command uses the accelerometer to take multiple measurements. By default,
#    Shake&Tune will write a chunk of data to disk every two measurements, and at the end of the
#    command will merge these chunks into the final .stdata file for processing. "2" is a very
#    conservative setting to avoid Klipper Timer Too Close errors on lower end devices with little
#    RAM, and should work for everyone. However, if you are using a powerful computer, you may
#    wish to increase this value to keep more measurements in memory (e.g., 15-20) before writing
#    the chunk and avoid stressing the filesystem too much.
# max_freq: 200
#    This setting defines the maximum frequency at which the calculation of the power spectral density
#    is cutoff. The default value should be fine for most machines and accelerometer combinations and
#    avoid touching it unless you know what you're doing.
# dpi: 300
#    Controls the resolution of the generated graphs. The default value of 300 dpi was optimized
#    and strikes a balance between performance and readability, ensuring that graphs are clear
#    without using too much RAM to generate them. Usually, you shouldn't need to change this value.

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [extruder]
#*# pid_version = 1
#*# pid_target = 290.00
#*# pid_tolerance = 0.0200
#*# control = pid
#*# pid_kp = 19.480
#*# pid_ki = 2.117
#*# pid_kd = 44.807
#*#
#*# [heater_bed]
#*# pid_version = 1
#*# pid_target = 110.00
#*# pid_tolerance = 0.0200
#*# control = pid
#*# pid_kp = 29.333
#*# pid_ki = 0.813
#*# pid_kd = 264.730
#*#
#*# [beacon model default]
#*# model_coef = 1.4063204930159687,
#*# 	  1.7589920234658711,
#*# 	  0.8013880673560592,
#*# 	  0.16127383046394922,
#*# 	  0.2413604546870666,
#*# 	  1.0647920474713548,
#*# 	  0.14325848524656562,
#*# 	  -1.0775274324060784,
#*# 	  0.006892756646956967,
#*# 	  0.49512089262163106
#*# model_domain = 1.7944253287545273e-07,1.9271335345995075e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 32.383058
#*# model_offset = 0.00000
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  0.006351, 0.002271, -0.004890, -0.012705, -0.021540, -0.027028, -0.031519, -0.035009, -0.037642, -0.038054, -0.040651, -0.043657, -0.047006, -0.049814, -0.049854, -0.046649, -0.043076, -0.040915, -0.038551, -0.036887, -0.032843, -0.022518, -0.010659, -0.000984, 0.002949
#*# 	  0.010610, 0.009981, 0.001809, -0.005177, -0.011413, -0.016094, -0.019580, -0.024325, -0.028664, -0.030159, -0.033174, -0.036453, -0.038708, -0.039528, -0.039322, -0.036934, -0.033850, -0.031411, -0.031439, -0.029007, -0.023698, -0.013968, -0.004334, 0.004356, 0.009132
#*# 	  0.013797, 0.012799, 0.005719, -0.001608, -0.008753, -0.013356, -0.016412, -0.021191, -0.026841, -0.027771, -0.027864, -0.030644, -0.032387, -0.033295, -0.031846, -0.028952, -0.025374, -0.026311, -0.029339, -0.027542, -0.020976, -0.011242, -0.000857, 0.009500, 0.015060
#*# 	  0.013632, 0.013442, 0.007330, -0.001985, -0.009649, -0.013221, -0.016422, -0.021995, -0.025247, -0.025746, -0.023609, -0.026850, -0.027646, -0.026851, -0.026838, -0.023695, -0.019882, -0.020747, -0.023781, -0.024636, -0.020868, -0.010006, 0.001803, 0.012751, 0.019445
#*# 	  0.019486, 0.018756, 0.011431, 0.001223, -0.005133, -0.008646, -0.012054, -0.015888, -0.019758, -0.019168, -0.018682, -0.019390, -0.019668, -0.019789, -0.018653, -0.016425, -0.014635, -0.017248, -0.018767, -0.019653, -0.016491, -0.004218, 0.008392, 0.020085, 0.033100
#*# 	  0.016912, 0.017665, 0.012785, 0.004762, -0.002505, -0.006149, -0.007753, -0.012378, -0.016343, -0.016078, -0.015981, -0.013460, -0.013476, -0.014492, -0.014704, -0.014051, -0.014287, -0.014603, -0.016057, -0.018320, -0.016040, -0.002939, 0.010619, 0.022054, 0.027688
#*# 	  0.015011, 0.014402, 0.009872, 0.001582, -0.004797, -0.007009, -0.006669, -0.009864, -0.014654, -0.014988, -0.015394, -0.015284, -0.014927, -0.016314, -0.014719, -0.013121, -0.011597, -0.012260, -0.016662, -0.018523, -0.014427, -0.003070, 0.010045, 0.022734, 0.029453
#*# 	  0.012479, 0.012735, 0.008825, 0.001033, -0.005644, -0.007356, -0.005495, -0.005897, -0.009650, -0.009791, -0.011426, -0.009771, -0.009375, -0.010284, -0.010082, -0.007806, -0.006727, -0.008343, -0.011822, -0.014772, -0.012644, -0.003508, 0.012174, 0.022710, 0.028290
#*# 	  0.018828, 0.016053, 0.010701, 0.004052, -0.004641, -0.008197, -0.008009, -0.006993, -0.007647, -0.007417, -0.007802, -0.008710, -0.008045, -0.008853, -0.007206, -0.005570, -0.006797, -0.008715, -0.011195, -0.014766, -0.013644, -0.003841, 0.010284, 0.020466, 0.025240
#*# 	  0.014248, 0.012608, 0.007700, 0.002258, -0.007132, -0.011370, -0.009910, -0.007479, -0.008086, -0.009892, -0.009875, -0.011595, -0.011593, -0.008306, -0.007672, -0.007429, -0.008451, -0.009430, -0.012428, -0.014450, -0.011547, -0.001559, 0.008910, 0.019142, 0.023452
#*# 	  0.016047, 0.016725, 0.010744, 0.003133, -0.005779, -0.009886, -0.008880, -0.006607, -0.007494, -0.009939, -0.011795, -0.011521, -0.010461, -0.010509, -0.010696, -0.009006, -0.008334, -0.010805, -0.012324, -0.012197, -0.006681, 0.003793, 0.013195, 0.022185, 0.026076
#*# 	  0.016873, 0.015878, 0.009513, -0.000505, -0.008605, -0.011629, -0.010326, -0.010320, -0.012699, -0.015929, -0.019045, -0.017279, -0.014572, -0.014332, -0.014309, -0.011433, -0.011120, -0.013101, -0.010934, -0.007416, -0.000658, 0.009345, 0.017979, 0.026640, 0.028261
#*# 	  0.018579, 0.015988, 0.007439, -0.001919, -0.008285, -0.010660, -0.010135, -0.010826, -0.014169, -0.017763, -0.020578, -0.022308, -0.022245, -0.022843, -0.020884, -0.017629, -0.015684, -0.016116, -0.016073, -0.013075, -0.007717, 0.002592, 0.011858, 0.021910, 0.021287
#*# 	  0.009195, 0.009877, 0.001567, -0.008701, -0.017040, -0.016547, -0.011918, -0.010512, -0.014724, -0.020190, -0.022924, -0.025176, -0.027082, -0.028240, -0.027142, -0.023710, -0.020710, -0.019011, -0.021545, -0.021894, -0.015842, -0.001743, 0.011854, 0.020390, 0.023382
#*# 	  0.015002, 0.007589, 0.001908, -0.010362, -0.016006, -0.012416, -0.008719, -0.009328, -0.013812, -0.019065, -0.020812, -0.023415, -0.024533, -0.025562, -0.021330, -0.016793, -0.014973, -0.017451, -0.021845, -0.022644, -0.019193, -0.007636, 0.006791, 0.017071, 0.020954
#*# 	  0.018220, 0.009700, 0.000665, -0.009814, -0.015360, -0.011112, -0.006374, -0.008147, -0.012412, -0.020208, -0.024247, -0.024210, -0.026227, -0.026696, -0.023710, -0.018694, -0.016139, -0.018693, -0.022529, -0.025387, -0.022296, -0.010194, 0.006999, 0.016824, 0.021099
#*# 	  0.010316, 0.004700, -0.006286, -0.015615, -0.020179, -0.017504, -0.012367, -0.012986, -0.018442, -0.025358, -0.028014, -0.028716, -0.028725, -0.027955, -0.026512, -0.023766, -0.020597, -0.020188, -0.025530, -0.028451, -0.028265, -0.017245, -0.002578, 0.007452, 0.012222
#*# 	  0.004551, 0.001192, -0.005512, -0.012729, -0.017593, -0.015136, -0.012345, -0.013067, -0.018176, -0.023586, -0.027107, -0.027684, -0.026711, -0.028418, -0.027766, -0.025676, -0.023933, -0.025026, -0.028811, -0.032269, -0.030007, -0.019795, -0.006229, 0.002176, 0.006907
#*# 	  0.007859, 0.005280, 0.001473, -0.005460, -0.009115, -0.008147, -0.007961, -0.007774, -0.009665, -0.015574, -0.018130, -0.020628, -0.021307, -0.021518, -0.020241, -0.018425, -0.019141, -0.018601, -0.021137, -0.023096, -0.022708, -0.012504, 0.000738, 0.008734, 0.012292
#*# 	  0.007387, 0.006099, 0.002145, -0.004862, -0.011134, -0.009852, -0.007587, -0.006318, -0.008773, -0.012491, -0.015910, -0.018895, -0.022106, -0.024095, -0.023244, -0.020538, -0.016794, -0.016300, -0.019474, -0.023281, -0.020362, -0.008568, 0.003228, 0.010371, 0.015487
#*# 	  0.004349, 0.002150, -0.001780, -0.006202, -0.011742, -0.010333, -0.008694, -0.007717, -0.010294, -0.014119, -0.015806, -0.018745, -0.021377, -0.025729, -0.027575, -0.023162, -0.021202, -0.022546, -0.026379, -0.029958, -0.026612, -0.015548, -0.003817, 0.004837, 0.005417
#*# 	  0.000927, 0.002393, 0.000931, -0.005209, -0.008334, -0.006771, -0.006006, -0.005460, -0.009037, -0.014142, -0.017724, -0.018950, -0.018958, -0.020972, -0.020423, -0.019393, -0.018390, -0.022432, -0.026586, -0.029012, -0.024728, -0.013215, -0.001879, 0.008182, 0.010667
#*# 	  -0.000416, 0.003371, 0.001303, -0.004863, -0.011798, -0.009309, -0.006631, -0.004655, -0.006932, -0.013895, -0.018506, -0.020835, -0.020278, -0.019255, -0.018315, -0.018183, -0.019437, -0.021851, -0.027116, -0.029802, -0.026899, -0.013527, -0.000438, 0.006979, 0.010734
#*# 	  0.003230, 0.003963, 0.003737, -0.002508, -0.010163, -0.009402, -0.006235, -0.004838, -0.010146, -0.016306, -0.019619, -0.022494, -0.022872, -0.022711, -0.021455, -0.021073, -0.019645, -0.019753, -0.024475, -0.027622, -0.022532, -0.010522, 0.001444, 0.008846, 0.011728
#*# 	  0.005802, 0.008378, 0.005762, 0.000006, -0.005609, -0.005764, -0.004187, -0.001608, -0.004324, -0.008581, -0.013458, -0.016090, -0.017066, -0.019002, -0.018726, -0.016908, -0.015480, -0.015298, -0.016683, -0.018385, -0.014221, -0.003554, 0.009636, 0.017748, 0.027654
#*# x_count = 25
#*# y_count = 25
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 50.0
#*# max_x = 330.0
#*# min_y = 50.0
#*# max_y = 330.0
