# This file contains common pin mappings for the BIGTREETECH Octopus Max EZ.
# To use this config, the firmware should be compiled for the
# STM32H723 with a "128KiB bootloader", "25 MHz crystal",
# and one of:
# Communication interface: "USB (on PA11/PA12)",
# Communication interface: "CAN bus (on PD0/PD1)", or
# Communication interface: "USB to CAN bus bridge (USB on PA11/PA12))" and CAN bus interface: "CAN bus (on PD0/PD1)".

# See docs/Config_Reference.md for a description of parameters.

#=====================================================
# MACROS
#=====================================================
[include macros.cfg]
[include Fan.cfg]
[include TMC Autotune.cfg]
[exclude_object]
[include TEST_SPEED.cfg]
[include timelapse.cfg]
[include temp_sensors.cfg]
[include z_tilt.cfg]
[include beacon.cfg]
[include LED.cfg]
[include resonance_tester.cfg]
[include input_shaper.cfg]
[include AFC/*.cfg]
[include axis_twist_compensation.cfg]
#====================================================0=
# VIRTUAL SD CARD
#=====================================================
[include mainsail.cfg]
[virtual_sdcard]
path: /home/pi/printer_data/gcodes

#=====================================================
# MCU ID
#=====================================================
[mcu]
serial: /dev/serial/by-id/usb-Klipper_stm32h723xx_3F003D001051313236343430-if00
[mcu EBBCan]
canbus_uuid: e75929009724
[mcu U2C]
canbus_uuid: 2246f0775ddc

####################################################################
# 	X/Y Stepper Settings
#####################################################################

########################################
# X Stepper on Motor1 (A Motor)
########################################
# Motor-1
[stepper_a]
step_pin: PC13
dir_pin: PC14
enable_pin: !PE6
microsteps: 16
rotation_distance: 40
endstop_pin: EBBCan:PB5
position_endstop: 1
position_max: 377
homing_speed: 150

[tmc5160 stepper_a]
cs_pin: PG14
spi_software_mosi_pin: PE14
spi_software_miso_pin: PE13
spi_software_sclk_pin: PE12
run_current: 1.4
interpolate: false
sense_resistor: 0.075

########################################
# Y Stepper on Motor2 (B Motor)
########################################
# Motor-2
[stepper_b]
step_pin: PE4
dir_pin: PE5
enable_pin: !PE3
microsteps: 16
rotation_distance: 40
endstop_pin: PF0
position_endstop: 370
position_max: 370
homing_speed: 150

[tmc5160 stepper_b]
cs_pin: PG13
spi_software_mosi_pin: PE14
spi_software_miso_pin: PE13
spi_software_sclk_pin: PE12
run_current: 1.4
interpolate: false
sense_resistor: 0.075

########################################
# C Stepper on Motor3 (C Motor)
########################################

[stepper_c]
step_pin: PE1
dir_pin: !PE0
enable_pin: !PE2
microsteps: 16
rotation_distance: 40
position_endstop: 370
position_max: 370
endstop_pin: PF4
homing_speed: 150

[tmc5160 stepper_c]
cs_pin: PG12
spi_software_mosi_pin: PE14
spi_software_miso_pin: PE13
spi_software_sclk_pin: PE12
run_current: 1.4
sense_resistor: 0.075
interpolate: false

########################################
# C1 Stepper on Motor4 (C1 Motor)
########################################

[stepper_c1]
step_pin: PB8
dir_pin: PB9
enable_pin: !PB7
microsteps: 16
rotation_distance: 40

[tmc5160 stepper_c1]
cs_pin: PG11
spi_software_mosi_pin: PE14
spi_software_miso_pin: PE13
spi_software_sclk_pin: PE12
run_current: 1.4
sense_resistor: 0.075
interpolate: false

########################################
# STEPPER Z
########################################
# Motor-5 Rear Center
[stepper_z]
step_pin: PB5
dir_pin: PB4
enable_pin: !PB6
endstop_pin: probe:z_virtual_endstop
microsteps: 16
full_steps_per_rotation: 200
rotation_distance: 2
position_max: 370
position_min: -4
homing_speed: 10
homing_retract_dist: 0

[tmc2209 stepper_z]
interpolate: false
uart_pin: PG10
run_current: 1.0
sense_resistor: 0.11
stealthchop_threshold: 999999

# Motor-6 Front Left 
[stepper_z1] 
step_pin: PG15
dir_pin: PB3
enable_pin: !PD5
microsteps: 16
full_steps_per_rotation: 200
rotation_distance: 2

[tmc2209 stepper_z1]
interpolate: false
uart_pin: PG9
run_current: 1.0
sense_resistor: 0.11
stealthchop_threshold: 999999

# motor-7 Front Right
[stepper_z2]
step_pin:PD3
dir_pin: PD2
enable_pin: !PD4
microsteps: 16
full_steps_per_rotation: 200
rotation_distance: 2

[tmc2209 stepper_z2]
interpolate: false
uart_pin: PD7
run_current: 1.0
sense_resistor: 0.11
stealthchop_threshold: 999999

########################################
# EXTRUDER
########################################
[extruder]
step_pin: EBBCan: PD0
dir_pin: !EBBCan: PD1
enable_pin: !EBBCan: PD2
microsteps: 16
rotation_distance: 35.1
gear_ratio: 60:10
nozzle_diameter: 0.400
filament_diameter: 1.750
heater_pin: EBBCan: PB13
sensor_type: MAX31865
pwm_cycle_time: 0.00417
sensor_pin: EBBCan: PA4
spi_bus: spi1
rtd_nominal_r: 100
rtd_reference_r: 430
rtd_num_of_wires: 2
min_extrude_temp: 180
min_temp: 0
max_temp: 400
#control: pid
#pid_Kp: 21.527
#pid_Ki: 1.063
#pid_Kd: 108.982
full_steps_per_rotation: 200
pressure_advance: 0.031
pressure_advance_smooth_time: 0.02
max_extrude_only_distance: 400 

[tmc2209 extruder]
uart_pin: EBBCan: PA15
interpolate: false
run_current: 0.85 
sense_resistor: 0.11 

########################################
# BED MESH
########################################
[bed_mesh]
algorithm: bicubic
speed: 500
mesh_min: 50,50
mesh_max: 330,330
probe_count: 25,25

########################################
# IDLE TIMEOUT
########################################
[idle_timeout]
timeout: 172800

########################################
# HEATER BED
########################################
[heater_bed]
heater_pin: PA0
sensor_pin: PB1 # TB
sensor_type: EPCOS 100K B57560G104F
#control: pid
#pid_kp: 27
#pid_ki: 0.08
#pid_kd: 0
min_temp: 0
max_temp: 120

#=====================================================
# Force Move
#=====================================================
[force_move]
enable_force_move: True

#=====================================================
# PRINTER LIMITS
#=====================================================
[printer]
kinematics: extended_corexy
home_y_axis_with_b_rail : True
max_velocity: 800
max_accel: 10000
max_z_velocity: 10
max_z_accel: 300
square_corner_velocity: 5.0

#[skew_correction]

#=====================================================
# SHAKETUNE
#=====================================================
[shaketune]
# result_folder: ~/printer_data/config/ShakeTune_results
#    Path where the processed results will be stored. If the folder doesn't exist,
#    it will be automatically created. You can change this if you'd like to store 
#    results in a different location.
# number_of_results_to_keep: 10
#    This setting defines how many results you want to keep in the result folder.
#    Once the specified number is exceeded, older results will be automatically deleted
#    to free up space on the SD card and avoid cluttering the results folder.
# keep_raw_data: False
#    If set to True, Shake&Tune will store both the processed graphs and the raw accelerometer
#    .stdata files in the results folder. This can be useful for debugging or archiving purposes.
#    Please always attach them when reporting any issues on GitHub or Discord.
# show_macros_in_webui: True
#    Mainsail and Fluidd doesn't create buttons for system commands (macros that are not part
#    of the printer.cfg file). This option allow Shake&Tune to inject them into the webui at runtime.
#    If set to False, the macros will be hidden but still accessible from the console by typing
#    their names manually, which can be useful if you prefer to encapsulate them into your own macros.
# timeout: 600
#    This defines the maximum processing time (in seconds) to allows to Shake&Tune for generating 
#    graphs from a .stdata file. 10 minutes should be more than enough in most cases, but if you have
#    slower hardware (e.g., older SD cards or low-performance devices), increase it to prevent timeouts.
# measurements_chunk_size: 2
#    Each Shake&Tune command uses the accelerometer to take multiple measurements. By default,
#    Shake&Tune will write a chunk of data to disk every two measurements, and at the end of the
#    command will merge these chunks into the final .stdata file for processing. "2" is a very
#    conservative setting to avoid Klipper Timer Too Close errors on lower end devices with little
#    RAM, and should work for everyone. However, if you are using a powerful computer, you may
#    wish to increase this value to keep more measurements in memory (e.g., 15-20) before writing
#    the chunk and avoid stressing the filesystem too much.
# max_freq: 200
#    This setting defines the maximum frequency at which the calculation of the power spectral density
#    is cutoff. The default value should be fine for most machines and accelerometer combinations and
#    avoid touching it unless you know what you're doing.
# dpi: 300
#    Controls the resolution of the generated graphs. The default value of 300 dpi was optimized
#    and strikes a balance between performance and readability, ensuring that graphs are clear
#    without using too much RAM to generate them. Usually, you shouldn't need to change this value.

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [extruder]
#*# pid_version = 1
#*# pid_target = 290.00
#*# pid_tolerance = 0.0200
#*# control = pid
#*# pid_kp = 19.480
#*# pid_ki = 2.117
#*# pid_kd = 44.807
#*#
#*# [heater_bed]
#*# pid_version = 1
#*# pid_target = 110.00
#*# pid_tolerance = 0.0200
#*# control = pid
#*# pid_kp = 29.333
#*# pid_ki = 0.813
#*# pid_kd = 264.730
#*#
#*# [beacon model default]
#*# model_coef = 1.409995941157518,
#*# 	  1.7671555394439027,
#*# 	  0.815368000527578,
#*# 	  0.15912537094870166,
#*# 	  0.12865146542406553,
#*# 	  0.9393396672595413,
#*# 	  0.30822404264317377,
#*# 	  -0.8512873892774131,
#*# 	  -0.06254208621736862,
#*# 	  0.3887840889987706
#*# model_domain = 1.7988685053309372e-07,1.9279051883585396e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 46.183553
#*# model_offset = 0.00000
#*#
#*# [axis_twist_compensation]
#*# z_compensations = -0.021450, 0.003440, 0.018009
#*# compensation_start_x = 50.0
#*# compensation_end_x = 330.0
#*# zy_compensations = 0.012152, 0.023932, -0.036084
#*# compensation_start_y = 50.0
#*# compensation_end_y = 330.0
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  0.074456, 0.170349, 0.285406, 0.365629, 0.354116, 0.261730, 0.149882, 0.059891, 0.006502, -0.012945, -0.017396, -0.019020, -0.020682, -0.021884, -0.021661, -0.020701, -0.021222, -0.022661, -0.021826, -0.020983, -0.021412, -0.017784, -0.013664, -0.010231, -0.006890
#*# 	  0.113100, 0.233728, 0.372739, 0.482822, 0.460959, 0.334570, 0.197502, 0.088002, 0.026223, 0.003011, -0.002187, -0.004391, -0.004626, -0.004283, -0.003744, -0.004272, -0.004638, -0.006212, -0.005448, -0.005278, -0.005371, -0.003578, 0.000472, 0.003816, 0.007449
#*# 	  0.123254, 0.236921, 0.375591, 0.469758, 0.448279, 0.324278, 0.192845, 0.090410, 0.030804, 0.012515, 0.009985, 0.008728, 0.009738, 0.010677, 0.011314, 0.012280, 0.011003, 0.007914, 0.004000, 0.004270, 0.006156, 0.008278, 0.010899, 0.016691, 0.021157
#*# 	  0.107531, 0.200389, 0.298887, 0.357293, 0.340533, 0.252927, 0.154244, 0.073572, 0.030784, 0.019465, 0.021949, 0.020746, 0.021676, 0.024529, 0.025644, 0.025050, 0.024069, 0.020365, 0.017737, 0.016818, 0.015604, 0.017822, 0.021914, 0.028044, 0.032125
#*# 	  0.087909, 0.146924, 0.207631, 0.239557, 0.226921, 0.173138, 0.108747, 0.058594, 0.034379, 0.031745, 0.034381, 0.036449, 0.038289, 0.039630, 0.041056, 0.040585, 0.037207, 0.031784, 0.029069, 0.028966, 0.027967, 0.031095, 0.036214, 0.042395, 0.049008
#*# 	  0.065653, 0.097205, 0.130118, 0.145250, 0.138912, 0.107476, 0.075102, 0.050323, 0.040633, 0.043065, 0.046308, 0.050787, 0.052051, 0.052848, 0.051521, 0.049065, 0.045845, 0.042959, 0.039567, 0.037563, 0.036532, 0.040640, 0.045827, 0.051631, 0.056238
#*# 	  0.054996, 0.066181, 0.077204, 0.083649, 0.080219, 0.069497, 0.059976, 0.051540, 0.048837, 0.051782, 0.054106, 0.056755, 0.058557, 0.057735, 0.058817, 0.057240, 0.055317, 0.051613, 0.047715, 0.044676, 0.043994, 0.046151, 0.051989, 0.060086, 0.067848
#*# 	  0.055343, 0.057692, 0.060548, 0.061702, 0.060819, 0.060940, 0.062389, 0.061077, 0.061236, 0.064733, 0.066357, 0.068287, 0.071676, 0.069988, 0.070101, 0.069657, 0.066483, 0.063204, 0.058830, 0.057017, 0.052525, 0.055607, 0.061099, 0.066644, 0.071083
#*# 	  0.064446, 0.064424, 0.063818, 0.066793, 0.064432, 0.064272, 0.066531, 0.068223, 0.071178, 0.075118, 0.076205, 0.076946, 0.078169, 0.079222, 0.080163, 0.079579, 0.073338, 0.069230, 0.066890, 0.062712, 0.059233, 0.061520, 0.067026, 0.071533, 0.075143
#*# 	  0.069571, 0.068667, 0.068209, 0.069675, 0.069409, 0.068827, 0.072859, 0.075189, 0.076674, 0.078734, 0.080392, 0.079039, 0.081262, 0.085745, 0.087679, 0.083874, 0.079554, 0.075305, 0.071743, 0.070283, 0.067891, 0.070274, 0.072442, 0.076832, 0.081070
#*# 	  0.076866, 0.077664, 0.077833, 0.078496, 0.076140, 0.076452, 0.079071, 0.082623, 0.083799, 0.084403, 0.085084, 0.086541, 0.088329, 0.089313, 0.089839, 0.088994, 0.085064, 0.079862, 0.078157, 0.078370, 0.078088, 0.080282, 0.082898, 0.087008, 0.090221
#*# 	  0.085550, 0.085568, 0.082815, 0.080366, 0.080548, 0.081736, 0.084949, 0.085143, 0.085550, 0.085659, 0.084453, 0.088158, 0.091458, 0.092172, 0.092791, 0.093158, 0.089455, 0.085269, 0.086010, 0.089847, 0.090010, 0.090906, 0.094905, 0.098342, 0.100793
#*# 	  0.093286, 0.092049, 0.087092, 0.085432, 0.086880, 0.088482, 0.091653, 0.090857, 0.089412, 0.089167, 0.089021, 0.089185, 0.091108, 0.090907, 0.092258, 0.093689, 0.091715, 0.088766, 0.088330, 0.089947, 0.089148, 0.091887, 0.094413, 0.100580, 0.103073
#*# 	  0.092867, 0.091603, 0.086647, 0.084388, 0.084788, 0.089167, 0.094651, 0.096423, 0.094292, 0.092678, 0.092115, 0.092058, 0.092226, 0.092038, 0.093127, 0.094200, 0.093105, 0.091421, 0.089451, 0.089160, 0.090866, 0.095631, 0.100811, 0.105107, 0.106687
#*# 	  0.101207, 0.098072, 0.092614, 0.089289, 0.091961, 0.099063, 0.104511, 0.104987, 0.102134, 0.100591, 0.100538, 0.100216, 0.101951, 0.101364, 0.104609, 0.106664, 0.105054, 0.099537, 0.095846, 0.093301, 0.092843, 0.097076, 0.102028, 0.107824, 0.111300
#*# 	  0.095848, 0.090909, 0.085878, 0.083812, 0.087012, 0.095768, 0.100815, 0.101509, 0.099079, 0.094551, 0.091612, 0.093507, 0.094757, 0.095196, 0.097631, 0.099762, 0.098064, 0.092742, 0.089066, 0.086764, 0.086071, 0.088056, 0.096789, 0.102267, 0.106419
#*# 	  0.083592, 0.077128, 0.068982, 0.067982, 0.071375, 0.078092, 0.084612, 0.085733, 0.082251, 0.078610, 0.077800, 0.078764, 0.080634, 0.082195, 0.083109, 0.083251, 0.083367, 0.081274, 0.074585, 0.071632, 0.067770, 0.070559, 0.075555, 0.082516, 0.086931
#*# 	  0.077396, 0.069763, 0.061232, 0.058851, 0.062390, 0.069292, 0.072707, 0.073416, 0.070967, 0.068922, 0.068095, 0.068774, 0.069751, 0.069856, 0.069830, 0.070249, 0.068606, 0.064830, 0.060289, 0.057909, 0.055436, 0.055784, 0.060380, 0.066208, 0.070036
#*# 	  0.075752, 0.067695, 0.058655, 0.056431, 0.061088, 0.064461, 0.065780, 0.067522, 0.068029, 0.065979, 0.065747, 0.064749, 0.064500, 0.065016, 0.066612, 0.065387, 0.062600, 0.060178, 0.057831, 0.055618, 0.051681, 0.052628, 0.057031, 0.060732, 0.062336
#*# 	  0.056895, 0.052289, 0.046675, 0.045058, 0.047761, 0.051929, 0.054710, 0.055683, 0.057538, 0.057026, 0.056941, 0.054697, 0.052235, 0.051446, 0.051479, 0.053233, 0.052093, 0.049923, 0.046384, 0.043485, 0.042440, 0.044975, 0.048458, 0.050580, 0.055116
#*# 	  0.031811, 0.028278, 0.027620, 0.030479, 0.034682, 0.038881, 0.042052, 0.042703, 0.042460, 0.043381, 0.044371, 0.042302, 0.040151, 0.037075, 0.035314, 0.036626, 0.036401, 0.031964, 0.027411, 0.023944, 0.024085, 0.026219, 0.028245, 0.033502, 0.037986
#*# 	  0.011820, 0.014260, 0.015759, 0.019442, 0.024718, 0.030172, 0.031584, 0.031674, 0.031636, 0.029981, 0.028987, 0.029254, 0.029406, 0.028612, 0.028953, 0.028202, 0.025279, 0.019299, 0.014377, 0.012807, 0.013350, 0.012967, 0.018299, 0.024119, 0.028855
#*# 	  -0.001559, 0.000103, 0.002937, 0.006016, 0.008597, 0.013844, 0.017391, 0.019676, 0.020722, 0.017519, 0.014783, 0.014344, 0.015231, 0.017528, 0.018155, 0.015989, 0.011948, 0.006434, 0.001437, -0.002221, -0.002070, 0.001628, 0.006649, 0.011733, 0.015649
#*# 	  -0.010750, -0.013522, -0.009148, -0.005300, -0.002659, 0.000577, 0.005394, 0.005901, 0.003716, 0.002298, 0.000712, -0.001281, -0.001572, 0.000097, 0.001050, -0.000511, -0.002418, -0.004963, -0.009937, -0.012352, -0.010358, -0.008077, -0.003890, -0.000488, 0.003230
#*# 	  -0.010178, -0.020172, -0.019699, -0.016861, -0.013014, -0.010726, -0.005575, -0.004331, -0.003462, -0.004816, -0.007318, -0.009850, -0.011561, -0.011666, -0.011587, -0.010814, -0.011754, -0.013941, -0.016838, -0.019325, -0.017372, -0.014050, -0.008849, -0.004984, 0.000074
#*# x_count = 25
#*# y_count = 25
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 50.0
#*# max_x = 330.0
#*# min_y = 50.0
#*# max_y = 330.0
