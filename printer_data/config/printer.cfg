# This file contains common pin mappings for the BIGTREETECH Octopus Max EZ.
# To use this config, the firmware should be compiled for the
# STM32H723 with a "128KiB bootloader", "25 MHz crystal",
# and one of:
# Communication interface: "USB (on PA11/PA12)",
# Communication interface: "CAN bus (on PD0/PD1)", or
# Communication interface: "USB to CAN bus bridge (USB on PA11/PA12))" and CAN bus interface: "CAN bus (on PD0/PD1)".

# See docs/Config_Reference.md for a description of parameters.

#=====================================================
# MACROS
#=====================================================
[include macros.cfg]
[include Fan.cfg]
[include TMC Autotune.cfg]
[exclude_object]
[include TEST_SPEED.cfg]
[include timelapse.cfg]
[include temp_sensors.cfg]
[include z_tilt.cfg]
[include beacon.cfg]
[include LED.cfg]
[include resonance_tester.cfg]
[include input_shaper.cfg]
[include AFC/*.cfg]
#=====================================================
# ARCS SUPPORT
#=====================================================
[gcode_arcs]
resolution: 0.1

#====================================================0=
# VIRTUAL SD CARD
#=====================================================
[include mainsail.cfg]
[virtual_sdcard]
path: /home/pi/printer_data/gcodes

#=====================================================
# MCU ID
#=====================================================
[mcu]
serial: /dev/serial/by-id/usb-Klipper_stm32h723xx_3F003D001051313236343430-if00
[mcu EBBCan]
canbus_uuid: e75929009724
[mcu U2C]
canbus_uuid: 2246f0775ddc

####################################################################
# 	X/Y Stepper Settings
#####################################################################

########################################
# X Stepper on Motor1 (A Motor)
########################################
# Motor-1
[stepper_a]
step_pin: PC13
dir_pin: PC14
enable_pin: !PE6
microsteps: 16
rotation_distance: 40
endstop_pin: EBBCan:PB5
position_endstop: 1
position_max: 377
homing_speed: 150

[tmc5160 stepper_a]
cs_pin: PG14
spi_software_mosi_pin: PE14
spi_software_miso_pin: PE13
spi_software_sclk_pin: PE12
run_current: 1.4
interpolate: false
sense_resistor: 0.075

########################################
# Y Stepper on Motor2 (B Motor)
########################################
# Motor-2
[stepper_b]
step_pin: PE4
dir_pin: PE5
enable_pin: !PE3
microsteps: 16
rotation_distance: 40
endstop_pin: PF0
position_endstop: 370
position_max: 370
homing_speed: 150

[tmc5160 stepper_b]
cs_pin: PG13
spi_software_mosi_pin: PE14
spi_software_miso_pin: PE13
spi_software_sclk_pin: PE12
run_current: 1.4
interpolate: false
sense_resistor: 0.075

########################################
# C Stepper on Motor3 (C Motor)
########################################

[stepper_c]
step_pin: PE1
dir_pin: !PE0
enable_pin: !PE2
microsteps: 16
rotation_distance: 40
position_endstop: 370
position_max: 370
endstop_pin: PF4
homing_speed: 150

[tmc5160 stepper_c]
cs_pin: PG12
spi_software_mosi_pin: PE14
spi_software_miso_pin: PE13
spi_software_sclk_pin: PE12
run_current: 1.4
sense_resistor: 0.075
interpolate: false

########################################
# C1 Stepper on Motor4 (C1 Motor)
########################################

[stepper_c1]
step_pin: PB8
dir_pin: PB9
enable_pin: !PB7
microsteps: 16
rotation_distance: 40

[tmc5160 stepper_c1]
cs_pin: PG11
spi_software_mosi_pin: PE14
spi_software_miso_pin: PE13
spi_software_sclk_pin: PE12
run_current: 1.4
sense_resistor: 0.075
interpolate: false

########################################
# STEPPER Z
########################################
# Motor-5 Rear Center
[stepper_z]
step_pin: PB5
dir_pin: PB4
enable_pin: !PB6
endstop_pin: probe:z_virtual_endstop
microsteps: 16
full_steps_per_rotation: 200
rotation_distance: 2
position_max: 370
position_min: -4
homing_speed: 10
homing_retract_dist: 0

[tmc2209 stepper_z]
interpolate: false
uart_pin: PG10
run_current: 1.0
sense_resistor: 0.11

# Motor-6 Front Left 
[stepper_z1] 
step_pin: PG15
dir_pin: PB3
enable_pin: !PD5
microsteps: 16
full_steps_per_rotation: 200
rotation_distance: 2

[tmc2209 stepper_z1]
interpolate: false
uart_pin: PG9
run_current: 1.0
sense_resistor: 0.11

# motor-7 Front Right
[stepper_z2]
step_pin:PD3
dir_pin: PD2
enable_pin: !PD4
microsteps: 16
full_steps_per_rotation: 200
rotation_distance: 2

[tmc2209 stepper_z2]
interpolate: false
uart_pin: PD7
run_current: 1.0
sense_resistor: 0.11

########################################
# EXTRUDER
########################################
[extruder]
step_pin: EBBCan: PD0
dir_pin: !EBBCan: PD1
enable_pin: !EBBCan: PD2
microsteps: 16
rotation_distance: 35.1
gear_ratio: 60:10
nozzle_diameter: 0.400
filament_diameter: 1.750
heater_pin: EBBCan: PB13
sensor_type: MAX31865
pwm_cycle_time: 0.00417
sensor_pin: EBBCan: PA4
spi_bus: spi1
rtd_nominal_r: 100
rtd_reference_r: 430
rtd_num_of_wires: 2
min_extrude_temp: 180
min_temp: 0
max_temp: 400
#control: pid
#pid_Kp: 21.527
#pid_Ki: 1.063
#pid_Kd: 108.982
full_steps_per_rotation: 200
pressure_advance: 0.031
pressure_advance_smooth_time: 0.02
max_extrude_only_distance: 400 

[tmc2209 extruder]
uart_pin: EBBCan: PA15
interpolate: false
run_current: 0.85 
sense_resistor: 0.11 
driver_TBL: 0
driver_HEND: 6
driver_HSTRT: 7
driver_TOFF: 4

########################################
# BED MESH
########################################
[bed_mesh]
algorithm: bicubic
speed: 600
mesh_min: 50,50
mesh_max: 330,330
probe_count: 25,25

########################################
# IDLE TIMEOUT
########################################
[idle_timeout]
timeout: 172800

########################################
# HEATER BED
########################################
[heater_bed]
heater_pin: PA0
sensor_pin: PB1 # TB
sensor_type: EPCOS 100K B57560G104F
#control: pid
#pid_kp: 27
#pid_ki: 0.08
#pid_kd: 0
min_temp: 0
max_temp: 120

#=====================================================
# Force Move
#=====================================================
[force_move]
enable_force_move: True

#=====================================================
# PRINTER LIMITS
#=====================================================
[printer]
kinematics: extended_corexy
home_y_axis_with_b_rail : True
max_velocity: 800
max_accel: 10000
max_z_velocity: 10
max_z_accel: 300
square_corner_velocity: 5.0

#=====================================================
# SHAKETUNE
#=====================================================
[shaketune]
# result_folder: ~/printer_data/config/ShakeTune_results
#    Path where the processed results will be stored. If the folder doesn't exist,
#    it will be automatically created. You can change this if you'd like to store 
#    results in a different location.
# number_of_results_to_keep: 10
#    This setting defines how many results you want to keep in the result folder.
#    Once the specified number is exceeded, older results will be automatically deleted
#    to free up space on the SD card and avoid cluttering the results folder.
# keep_raw_data: False
#    If set to True, Shake&Tune will store both the processed graphs and the raw accelerometer
#    .stdata files in the results folder. This can be useful for debugging or archiving purposes.
#    Please always attach them when reporting any issues on GitHub or Discord.
# show_macros_in_webui: True
#    Mainsail and Fluidd doesn't create buttons for system commands (macros that are not part
#    of the printer.cfg file). This option allow Shake&Tune to inject them into the webui at runtime.
#    If set to False, the macros will be hidden but still accessible from the console by typing
#    their names manually, which can be useful if you prefer to encapsulate them into your own macros.
# timeout: 600
#    This defines the maximum processing time (in seconds) to allows to Shake&Tune for generating 
#    graphs from a .stdata file. 10 minutes should be more than enough in most cases, but if you have
#    slower hardware (e.g., older SD cards or low-performance devices), increase it to prevent timeouts.
# measurements_chunk_size: 2
#    Each Shake&Tune command uses the accelerometer to take multiple measurements. By default,
#    Shake&Tune will write a chunk of data to disk every two measurements, and at the end of the
#    command will merge these chunks into the final .stdata file for processing. "2" is a very
#    conservative setting to avoid Klipper Timer Too Close errors on lower end devices with little
#    RAM, and should work for everyone. However, if you are using a powerful computer, you may
#    wish to increase this value to keep more measurements in memory (e.g., 15-20) before writing
#    the chunk and avoid stressing the filesystem too much.
# max_freq: 200
#    This setting defines the maximum frequency at which the calculation of the power spectral density
#    is cutoff. The default value should be fine for most machines and accelerometer combinations and
#    avoid touching it unless you know what you're doing.
# dpi: 300
#    Controls the resolution of the generated graphs. The default value of 300 dpi was optimized
#    and strikes a balance between performance and readability, ensuring that graphs are clear
#    without using too much RAM to generate them. Usually, you shouldn't need to change this value.

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [extruder]
#*# pid_version = 1
#*# pid_target = 290.00
#*# pid_tolerance = 0.0200
#*# control = pid
#*# pid_kp = 19.556
#*# pid_ki = 2.155
#*# pid_kd = 44.371
#*#
#*# [heater_bed]
#*# pid_version = 1
#*# pid_target = 110.00
#*# pid_tolerance = 0.0200
#*# control = pid
#*# pid_kp = 30.789
#*# pid_ki = 0.901
#*# pid_kd = 263.053
#*#
#*# [beacon model default]
#*# model_coef = 1.4013970462771084,
#*# 	  1.730483490317472,
#*# 	  0.7235354026158026,
#*# 	  0.23309442341397335,
#*# 	  0.43708324376362334,
#*# 	  0.769468923382925,
#*# 	  -0.1027559269916173,
#*# 	  -0.6466660556606922,
#*# 	  0.14035665884480297,
#*# 	  0.31601213533669253
#*# model_domain = 1.788974580983116e-07,1.9269119103984763e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 49.324030
#*# model_offset = 0.00000
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	-0.062497, -0.064772, -0.063883, -0.065768, -0.066841, -0.067197, -0.065734, -0.065319, -0.063348, -0.067453, -0.073555, -0.076178, -0.078925, -0.081196, -0.082264, -0.085835, -0.087571, -0.088477, -0.092333, -0.088926, -0.094899, -0.089825, -0.089692, -0.082387, -0.079701
#*# 	-0.048616, -0.048421, -0.052475, -0.051332, -0.057522, -0.056339, -0.056828, -0.057047, -0.055219, -0.060497, -0.060312, -0.066767, -0.067235, -0.069480, -0.070144, -0.069839, -0.072933, -0.071174, -0.075830, -0.074911, -0.074404, -0.071212, -0.069585, -0.067151, -0.063863
#*# 	-0.041456, -0.042398, -0.042900, -0.043920, -0.043826, -0.045526, -0.045003, -0.045662, -0.048351, -0.048058, -0.051869, -0.050323, -0.051649, -0.053498, -0.056228, -0.056812, -0.055404, -0.057542, -0.057318, -0.060050, -0.056781, -0.056688, -0.055739, -0.052697, -0.050685
#*# 	-0.030062, -0.029898, -0.027619, -0.031504, -0.029958, -0.034401, -0.032423, -0.032853, -0.035573, -0.034675, -0.036278, -0.036342, -0.037595, -0.037042, -0.040918, -0.040741, -0.041275, -0.042983, -0.046920, -0.050987, -0.050711, -0.050507, -0.046767, -0.041685, -0.039394
#*# 	-0.024335, -0.019117, -0.022339, -0.023321, -0.023640, -0.024432, -0.024303, -0.029246, -0.030086, -0.030789, -0.027940, -0.027671, -0.026603, -0.028980, -0.029664, -0.025114, -0.028896, -0.028285, -0.034499, -0.039175, -0.042659, -0.040674, -0.034197, -0.030549, -0.025427
#*# 	-0.021919, -0.020930, -0.021941, -0.019755, -0.023151, -0.019389, -0.022956, -0.022980, -0.024674, -0.023816, -0.021779, -0.019244, -0.019693, -0.022456, -0.020739, -0.021574, -0.021033, -0.022596, -0.026934, -0.032336, -0.035559, -0.034581, -0.031464, -0.024147, -0.020625
#*# 	-0.023626, -0.022221, -0.020649, -0.019115, -0.019639, -0.017643, -0.017856, -0.017255, -0.018875, -0.016474, -0.014543, -0.014396, -0.013063, -0.016013, -0.014819, -0.016125, -0.013239, -0.015227, -0.020201, -0.026102, -0.030800, -0.030610, -0.030549, -0.024010, -0.021020
#*# 	-0.026654, -0.023104, -0.024417, -0.021051, -0.018659, -0.017199, -0.013742, -0.014676, -0.011242, -0.011331, -0.006984, -0.004367, -0.003490, -0.004799, -0.005960, -0.003752, -0.007706, -0.009142, -0.014515, -0.022081, -0.026065, -0.026503, -0.023431, -0.021846, -0.017186
#*# 	-0.019168, -0.018963, -0.017525, -0.018771, -0.018863, -0.016637, -0.011704, -0.008268, -0.005417, -0.003174, -0.001703, 0.002083, -0.000738, -0.001356, -0.001510, -0.000255, -0.003007, -0.006484, -0.008771, -0.015584, -0.018951, -0.020989, -0.018679, -0.016670, -0.012515
#*# 	-0.018423, -0.019195, -0.018725, -0.021541, -0.020328, -0.017314, -0.011105, -0.005795, -0.005650, -0.002343, -0.002632, -0.001297, -0.002087, -0.003069, -0.001469, -0.002836, -0.002587, -0.004381, -0.007214, -0.009152, -0.011755, -0.012947, -0.012607, -0.009728, -0.007072
#*# 	-0.015436, -0.014214, -0.017446, -0.017844, -0.018195, -0.013852, -0.009036, -0.004019, 0.000697, -0.000023, 0.000599, -0.000608, 0.001698, 0.001287, 0.001209, 0.001541, 0.001546, -0.000099, -0.003677, -0.004031, -0.006823, -0.006435, -0.006662, -0.002720, -0.000799
#*# 	-0.021970, -0.019339, -0.021520, -0.017899, -0.020606, -0.014506, -0.010946, -0.004940, -0.001985, -0.001795, -0.001908, -0.003031, -0.001207, -0.002313, -0.001210, -0.000094, 0.000302, -0.000077, -0.001690, -0.002590, -0.005769, -0.005488, -0.003703, -0.001195, -0.000802
#*# 	-0.024096, -0.024143, -0.024250, -0.024827, -0.023446, -0.020037, -0.014203, -0.005980, -0.002621, -0.002665, -0.005519, -0.007058, -0.007978, -0.009756, -0.006377, -0.002926, -0.001350, -0.001745, -0.004909, -0.007244, -0.008288, -0.008233, -0.008426, -0.005517, -0.004736
#*# 	-0.025571, -0.025969, -0.028069, -0.029395, -0.026295, -0.023582, -0.012961, -0.007291, -0.006659, -0.007072, -0.009153, -0.009522, -0.010278, -0.009944, -0.009816, -0.008555, -0.011328, -0.010762, -0.012810, -0.015764, -0.016922, -0.017240, -0.017484, -0.014134, -0.011648
#*# 	-0.028326, -0.027670, -0.029248, -0.030711, -0.028999, -0.020197, -0.013357, -0.008692, -0.004702, -0.004488, -0.007126, -0.008014, -0.008786, -0.008665, -0.008703, -0.009962, -0.013080, -0.014715, -0.017060, -0.019038, -0.020873, -0.019465, -0.017139, -0.012225, -0.008118
#*# 	-0.031641, -0.032437, -0.033363, -0.033966, -0.032847, -0.025516, -0.016503, -0.010271, -0.009733, -0.009735, -0.010143, -0.010294, -0.011545, -0.010307, -0.010628, -0.010081, -0.013862, -0.017205, -0.019916, -0.022857, -0.023805, -0.023746, -0.018602, -0.014622, -0.012655
#*# 	-0.039134, -0.039808, -0.041187, -0.041650, -0.039164, -0.032258, -0.023769, -0.018383, -0.016920, -0.017613, -0.017009, -0.016634, -0.017661, -0.017753, -0.017862, -0.020030, -0.022896, -0.026858, -0.034470, -0.035699, -0.035409, -0.032897, -0.030551, -0.026447, -0.024358
#*# 	-0.045751, -0.046285, -0.049257, -0.049577, -0.048723, -0.039587, -0.030464, -0.026532, -0.023764, -0.024271, -0.025146, -0.025291, -0.023981, -0.024036, -0.024064, -0.024925, -0.028245, -0.032198, -0.037175, -0.038254, -0.039420, -0.037682, -0.035497, -0.032334, -0.031083
#*# 	-0.044564, -0.045589, -0.045984, -0.048336, -0.045899, -0.038956, -0.033005, -0.029914, -0.027268, -0.025521, -0.025819, -0.024422, -0.024730, -0.024434, -0.025568, -0.027514, -0.032948, -0.035924, -0.037680, -0.039234, -0.040594, -0.039085, -0.035417, -0.032743, -0.030489
#*# 	-0.047238, -0.049426, -0.050535, -0.052239, -0.049466, -0.046085, -0.040238, -0.036037, -0.032949, -0.032243, -0.033453, -0.034130, -0.034820, -0.034334, -0.034163, -0.035850, -0.040422, -0.043591, -0.045223, -0.044908, -0.044371, -0.041856, -0.040567, -0.037586, -0.034879
#*# 	-0.057415, -0.060509, -0.062651, -0.061543, -0.060093, -0.055787, -0.051328, -0.048046, -0.044517, -0.042332, -0.042491, -0.042806, -0.043440, -0.045926, -0.048582, -0.048992, -0.050350, -0.054113, -0.056807, -0.056091, -0.055183, -0.053947, -0.051556, -0.045523, -0.042938
#*# 	-0.067905, -0.065126, -0.067174, -0.067503, -0.066513, -0.061907, -0.059128, -0.054122, -0.050180, -0.049834, -0.052338, -0.052750, -0.054258, -0.057539, -0.058139, -0.057567, -0.059708, -0.063671, -0.064467, -0.064401, -0.064987, -0.061759, -0.058859, -0.053915, -0.051150
#*# 	-0.079870, -0.076910, -0.075366, -0.076231, -0.074552, -0.070472, -0.066859, -0.062025, -0.060146, -0.061148, -0.061469, -0.062238, -0.063377, -0.063698, -0.063601, -0.065853, -0.067614, -0.068353, -0.070124, -0.072603, -0.073563, -0.069105, -0.066855, -0.062345, -0.058931
#*# 	-0.091701, -0.091470, -0.088294, -0.086082, -0.083423, -0.080267, -0.073720, -0.069688, -0.068954, -0.070080, -0.069636, -0.071253, -0.072899, -0.073545, -0.075092, -0.076999, -0.074988, -0.078568, -0.080499, -0.082277, -0.081559, -0.077697, -0.076074, -0.071104, -0.066393
#*# 	-0.094761, -0.095267, -0.093719, -0.090716, -0.085648, -0.081183, -0.077505, -0.072901, -0.069561, -0.069753, -0.071014, -0.073231, -0.073922, -0.075292, -0.076920, -0.076929, -0.079869, -0.082871, -0.085052, -0.086654, -0.085337, -0.080799, -0.075828, -0.072792, -0.068376
#*# x_count = 25
#*# y_count = 25
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 50.0
#*# max_x = 330.0
#*# min_y = 50.0
#*# max_y = 330.0
