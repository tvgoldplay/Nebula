# This file contains common pin mappings for the BIGTREETECH Octopus Max EZ.
# To use this config, the firmware should be compiled for the
# STM32H723 with a "128KiB bootloader", "25 MHz crystal",
# and one of:
# Communication interface: "USB (on PA11/PA12)",
# Communication interface: "CAN bus (on PD0/PD1)", or
# Communication interface: "USB to CAN bus bridge (USB on PA11/PA12))" and CAN bus interface: "CAN bus (on PD0/PD1)".

# See docs/Config_Reference.md for a description of parameters.

#=====================================================
# MACROS
#=====================================================
[include macros.cfg]
[include Fan.cfg]
[include TMC Autotune.cfg]
[exclude_object]
[include TEST_SPEED.cfg]
[include timelapse.cfg]
[include temp_sensors.cfg]
[include z_tilt.cfg]
[include beacon.cfg]
[include LED.cfg]
[include resonance_tester.cfg]
[include input_shaper.cfg]
[include AFC/*.cfg]
[include axis_twist_compensation.cfg]
#====================================================0=
# VIRTUAL SD CARD
#=====================================================
[include mainsail.cfg]
[virtual_sdcard]
path: /home/pi/printer_data/gcodes

#=====================================================
# MCU ID
#=====================================================
[mcu]
serial: /dev/serial/by-id/usb-Klipper_stm32h723xx_3F003D001051313236343430-if00
[mcu EBBCan]
canbus_uuid: e75929009724
[mcu U2C]
canbus_uuid: 2246f0775ddc

####################################################################
# 	X/Y Stepper Settings
#####################################################################

########################################
# X Stepper on Motor1 (A Motor)
########################################
# Motor-1
[stepper_a]
step_pin: PC13
dir_pin: PC14
enable_pin: !PE6
microsteps: 16
rotation_distance: 40
endstop_pin: EBBCan:PB5
position_endstop: 1
position_max: 377
homing_speed: 150

[tmc5160 stepper_a]
cs_pin: PG14
spi_software_mosi_pin: PE14
spi_software_miso_pin: PE13
spi_software_sclk_pin: PE12
run_current: 1.4
interpolate: false
sense_resistor: 0.075

########################################
# Y Stepper on Motor2 (B Motor)
########################################
# Motor-2
[stepper_b]
step_pin: PE4
dir_pin: PE5
enable_pin: !PE3
microsteps: 16
rotation_distance: 40
endstop_pin: PF0
position_endstop: 370
position_max: 370
homing_speed: 150

[tmc5160 stepper_b]
cs_pin: PG13
spi_software_mosi_pin: PE14
spi_software_miso_pin: PE13
spi_software_sclk_pin: PE12
run_current: 1.4
interpolate: false
sense_resistor: 0.075

########################################
# C Stepper on Motor3 (C Motor)
########################################

[stepper_c]
step_pin: PE1
dir_pin: !PE0
enable_pin: !PE2
microsteps: 16
rotation_distance: 40
position_endstop: 370
position_max: 370
endstop_pin: PF4
homing_speed: 150

[tmc5160 stepper_c]
cs_pin: PG12
spi_software_mosi_pin: PE14
spi_software_miso_pin: PE13
spi_software_sclk_pin: PE12
run_current: 1.4
sense_resistor: 0.075
interpolate: false

########################################
# C1 Stepper on Motor4 (C1 Motor)
########################################

[stepper_c1]
step_pin: PB8
dir_pin: PB9
enable_pin: !PB7
microsteps: 16
rotation_distance: 40

[tmc5160 stepper_c1]
cs_pin: PG11
spi_software_mosi_pin: PE14
spi_software_miso_pin: PE13
spi_software_sclk_pin: PE12
run_current: 1.4
sense_resistor: 0.075
interpolate: false

########################################
# STEPPER Z
########################################
# Motor-5 Rear Center
[stepper_z]
step_pin: PB5
dir_pin: PB4
enable_pin: !PB6
endstop_pin: probe:z_virtual_endstop
microsteps: 16
full_steps_per_rotation: 200
rotation_distance: 2
position_max: 370
position_min: -4
homing_speed: 10
homing_retract_dist: 0

[tmc2209 stepper_z]
interpolate: false
uart_pin: PG10
run_current: 1.0
sense_resistor: 0.11
stealthchop_threshold: 999999

# Motor-6 Front Left 
[stepper_z1] 
step_pin: PG15
dir_pin: PB3
enable_pin: !PD5
microsteps: 16
full_steps_per_rotation: 200
rotation_distance: 2

[tmc2209 stepper_z1]
interpolate: false
uart_pin: PG9
run_current: 1.0
sense_resistor: 0.11
stealthchop_threshold: 999999

# motor-7 Front Right
[stepper_z2]
step_pin:PD3
dir_pin: PD2
enable_pin: !PD4
microsteps: 16
full_steps_per_rotation: 200
rotation_distance: 2

[tmc2209 stepper_z2]
interpolate: false
uart_pin: PD7
run_current: 1.0
sense_resistor: 0.11
stealthchop_threshold: 999999

########################################
# EXTRUDER
########################################
[extruder]
step_pin: EBBCan: PD0
dir_pin: !EBBCan: PD1
enable_pin: !EBBCan: PD2
microsteps: 16
rotation_distance: 35.1
gear_ratio: 60:10
nozzle_diameter: 0.400
filament_diameter: 1.750
heater_pin: EBBCan: PB13
sensor_type: MAX31865
pwm_cycle_time: 0.00417
sensor_pin: EBBCan: PA4
spi_bus: spi1
rtd_nominal_r: 100
rtd_reference_r: 430
rtd_num_of_wires: 2
min_extrude_temp: 180
min_temp: 0
max_temp: 400
#control: pid
#pid_Kp: 21.527
#pid_Ki: 1.063
#pid_Kd: 108.982
full_steps_per_rotation: 200
pressure_advance: 0.031
pressure_advance_smooth_time: 0.02
max_extrude_only_distance: 400 

[tmc2209 extruder]
uart_pin: EBBCan: PA15
interpolate: false
run_current: 0.85 
sense_resistor: 0.11 

########################################
# BED MESH
########################################
[bed_mesh]
algorithm: bicubic
speed: 500
mesh_min: 50,50
mesh_max: 330,330
probe_count: 25,25

########################################
# IDLE TIMEOUT
########################################
[idle_timeout]
timeout: 172800

########################################
# HEATER BED
########################################
[heater_bed]
heater_pin: PA0
sensor_pin: PB1 # TB
sensor_type: EPCOS 100K B57560G104F
#control: pid
#pid_kp: 27
#pid_ki: 0.08
#pid_kd: 0
min_temp: 0
max_temp: 120

#=====================================================
# Force Move
#=====================================================
[force_move]
enable_force_move: True

#=====================================================
# PRINTER LIMITS
#=====================================================
[printer]
kinematics: extended_corexy
home_y_axis_with_b_rail : True
max_velocity: 800
max_accel: 10000
max_z_velocity: 10
max_z_accel: 300
square_corner_velocity: 5.0

#[skew_correction]

#=====================================================
# SHAKETUNE
#=====================================================
[shaketune]
# result_folder: ~/printer_data/config/ShakeTune_results
#    Path where the processed results will be stored. If the folder doesn't exist,
#    it will be automatically created. You can change this if you'd like to store 
#    results in a different location.
# number_of_results_to_keep: 10
#    This setting defines how many results you want to keep in the result folder.
#    Once the specified number is exceeded, older results will be automatically deleted
#    to free up space on the SD card and avoid cluttering the results folder.
# keep_raw_data: False
#    If set to True, Shake&Tune will store both the processed graphs and the raw accelerometer
#    .stdata files in the results folder. This can be useful for debugging or archiving purposes.
#    Please always attach them when reporting any issues on GitHub or Discord.
# show_macros_in_webui: True
#    Mainsail and Fluidd doesn't create buttons for system commands (macros that are not part
#    of the printer.cfg file). This option allow Shake&Tune to inject them into the webui at runtime.
#    If set to False, the macros will be hidden but still accessible from the console by typing
#    their names manually, which can be useful if you prefer to encapsulate them into your own macros.
# timeout: 600
#    This defines the maximum processing time (in seconds) to allows to Shake&Tune for generating 
#    graphs from a .stdata file. 10 minutes should be more than enough in most cases, but if you have
#    slower hardware (e.g., older SD cards or low-performance devices), increase it to prevent timeouts.
# measurements_chunk_size: 2
#    Each Shake&Tune command uses the accelerometer to take multiple measurements. By default,
#    Shake&Tune will write a chunk of data to disk every two measurements, and at the end of the
#    command will merge these chunks into the final .stdata file for processing. "2" is a very
#    conservative setting to avoid Klipper Timer Too Close errors on lower end devices with little
#    RAM, and should work for everyone. However, if you are using a powerful computer, you may
#    wish to increase this value to keep more measurements in memory (e.g., 15-20) before writing
#    the chunk and avoid stressing the filesystem too much.
# max_freq: 200
#    This setting defines the maximum frequency at which the calculation of the power spectral density
#    is cutoff. The default value should be fine for most machines and accelerometer combinations and
#    avoid touching it unless you know what you're doing.
# dpi: 300
#    Controls the resolution of the generated graphs. The default value of 300 dpi was optimized
#    and strikes a balance between performance and readability, ensuring that graphs are clear
#    without using too much RAM to generate them. Usually, you shouldn't need to change this value.

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [extruder]
#*# pid_version = 1
#*# pid_target = 290.00
#*# pid_tolerance = 0.0200
#*# control = pid
#*# pid_kp = 19.480
#*# pid_ki = 2.117
#*# pid_kd = 44.807
#*#
#*# [heater_bed]
#*# pid_version = 1
#*# pid_target = 110.00
#*# pid_tolerance = 0.0200
#*# control = pid
#*# pid_kp = 29.333
#*# pid_ki = 0.813
#*# pid_kd = 264.730
#*#
#*# [beacon model default]
#*# model_coef = 1.4229313754556592,
#*# 	  1.766706883254033,
#*# 	  0.7276958586905097,
#*# 	  0.13898815124770525,
#*# 	  0.4475977555610416,
#*# 	  1.1289128046519874,
#*# 	  -0.11743316784738257,
#*# 	  -1.1578872047563282,
#*# 	  0.11886480281335886,
#*# 	  0.5264101728055268
#*# model_domain = 1.8045746358124483e-07,1.9285002082865096e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 43.312406
#*# model_offset = 0.00000
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  0.009654, 0.007915, 0.006297, 0.003270, 0.000872, 0.000103, -0.002459, -0.003723, -0.003676, -0.002408, -0.003112, -0.006004, -0.007934, -0.009474, -0.009309, -0.008616, -0.008913, -0.010244, -0.010124, -0.008734, -0.009322, -0.006634, -0.003412, 0.000247, 0.002172
#*# 	  0.019249, 0.018779, 0.015700, 0.014836, 0.015912, 0.014498, 0.011634, 0.008569, 0.007746, 0.008253, 0.007043, 0.004591, 0.002646, 0.003050, 0.003860, 0.003532, 0.002879, 0.001152, 0.001378, 0.002150, 0.001794, 0.002838, 0.005474, 0.008751, 0.012548
#*# 	  0.024521, 0.024257, 0.022639, 0.022708, 0.022712, 0.020455, 0.018586, 0.014819, 0.011646, 0.013837, 0.015055, 0.012906, 0.013148, 0.012888, 0.014246, 0.014636, 0.013337, 0.008767, 0.006449, 0.006947, 0.008536, 0.010124, 0.012163, 0.017501, 0.022168
#*# 	  0.026168, 0.028091, 0.026102, 0.023173, 0.023177, 0.023372, 0.021197, 0.016629, 0.016113, 0.017751, 0.022250, 0.019969, 0.020053, 0.021785, 0.022668, 0.022554, 0.021275, 0.017145, 0.014219, 0.013570, 0.013366, 0.014425, 0.018327, 0.023764, 0.028500
#*# 	  0.034133, 0.034803, 0.032830, 0.029307, 0.029466, 0.030461, 0.028658, 0.024827, 0.024143, 0.026978, 0.030074, 0.029846, 0.031260, 0.032357, 0.032663, 0.032639, 0.029674, 0.024824, 0.021836, 0.021584, 0.019649, 0.023311, 0.027586, 0.033852, 0.039414
#*# 	  0.036016, 0.038481, 0.037261, 0.036237, 0.036599, 0.036124, 0.036315, 0.031815, 0.030538, 0.032512, 0.035438, 0.038498, 0.039832, 0.040339, 0.038841, 0.035724, 0.033529, 0.029130, 0.027765, 0.024683, 0.022997, 0.027378, 0.031863, 0.038398, 0.042437
#*# 	  0.036702, 0.037238, 0.037212, 0.035655, 0.036025, 0.037899, 0.039594, 0.036722, 0.034204, 0.035450, 0.037781, 0.039455, 0.040544, 0.040464, 0.041058, 0.039635, 0.038450, 0.034068, 0.029549, 0.026272, 0.025642, 0.028110, 0.033710, 0.041670, 0.046747
#*# 	  0.036689, 0.037428, 0.037860, 0.036303, 0.037462, 0.039676, 0.042916, 0.041836, 0.040567, 0.043036, 0.044091, 0.046056, 0.047963, 0.047086, 0.047794, 0.046462, 0.044468, 0.040172, 0.035452, 0.033322, 0.029406, 0.032252, 0.036880, 0.043359, 0.046858
#*# 	  0.041141, 0.041262, 0.041013, 0.041205, 0.039548, 0.040070, 0.041686, 0.043176, 0.045494, 0.048111, 0.049092, 0.049117, 0.049144, 0.051070, 0.051883, 0.050449, 0.045041, 0.040804, 0.037966, 0.032710, 0.030458, 0.032193, 0.037987, 0.041746, 0.046411
#*# 	  0.041278, 0.039272, 0.038136, 0.039366, 0.038411, 0.037994, 0.041874, 0.043218, 0.044513, 0.046602, 0.047470, 0.046134, 0.047395, 0.051679, 0.052752, 0.049090, 0.045399, 0.040570, 0.037368, 0.035204, 0.033042, 0.036128, 0.037746, 0.041849, 0.045808
#*# 	  0.041566, 0.043157, 0.041609, 0.042311, 0.040359, 0.040556, 0.042978, 0.044897, 0.046386, 0.046138, 0.046795, 0.047286, 0.048413, 0.050132, 0.048918, 0.048844, 0.045555, 0.040015, 0.038200, 0.038407, 0.038345, 0.039897, 0.042742, 0.046048, 0.048892
#*# 	  0.045326, 0.044177, 0.042065, 0.039340, 0.039274, 0.040543, 0.043287, 0.042344, 0.042345, 0.041102, 0.041326, 0.042312, 0.045789, 0.046202, 0.047444, 0.047828, 0.043868, 0.040369, 0.040231, 0.044081, 0.044157, 0.044790, 0.048920, 0.051656, 0.053186
#*# 	  0.046696, 0.044700, 0.040086, 0.037900, 0.039011, 0.041448, 0.043594, 0.042241, 0.040971, 0.039377, 0.039023, 0.038654, 0.038757, 0.039787, 0.041713, 0.042915, 0.040524, 0.038116, 0.036753, 0.039672, 0.037940, 0.040092, 0.042863, 0.047629, 0.051775
#*# 	  0.039690, 0.038325, 0.032177, 0.029458, 0.030831, 0.034921, 0.041388, 0.041309, 0.039364, 0.036012, 0.036289, 0.035983, 0.035009, 0.034253, 0.035240, 0.037350, 0.036681, 0.033929, 0.031539, 0.031944, 0.033597, 0.038339, 0.042635, 0.046736, 0.048970
#*# 	  0.042382, 0.039488, 0.032862, 0.027885, 0.031303, 0.038974, 0.043920, 0.043689, 0.040781, 0.038524, 0.038366, 0.038586, 0.038704, 0.038038, 0.042195, 0.043579, 0.041543, 0.037181, 0.032256, 0.031009, 0.029898, 0.033504, 0.038388, 0.043220, 0.046951
#*# 	  0.040509, 0.034994, 0.029534, 0.027190, 0.029919, 0.037999, 0.044037, 0.043012, 0.040891, 0.036342, 0.033629, 0.034354, 0.035010, 0.035582, 0.038483, 0.040256, 0.038917, 0.033754, 0.029376, 0.026828, 0.025643, 0.028517, 0.035924, 0.041798, 0.046542
#*# 	  0.031222, 0.025958, 0.019181, 0.018833, 0.021916, 0.028850, 0.035024, 0.036278, 0.032433, 0.028057, 0.027409, 0.028123, 0.028677, 0.029919, 0.031080, 0.031634, 0.031945, 0.029839, 0.023182, 0.020008, 0.016982, 0.019213, 0.024165, 0.029470, 0.034108
#*# 	  0.023617, 0.019964, 0.016680, 0.016980, 0.021657, 0.027851, 0.032405, 0.031616, 0.029225, 0.026426, 0.025339, 0.025487, 0.026268, 0.025866, 0.026189, 0.026757, 0.024794, 0.021662, 0.016935, 0.014556, 0.012362, 0.012268, 0.015544, 0.021307, 0.024599
#*# 	  0.022659, 0.019821, 0.020652, 0.022404, 0.026607, 0.031274, 0.032105, 0.033624, 0.033969, 0.031692, 0.030408, 0.029843, 0.027681, 0.029168, 0.030622, 0.029855, 0.027218, 0.024162, 0.021512, 0.019828, 0.015368, 0.016626, 0.020396, 0.022940, 0.025629
#*# 	  0.019393, 0.017903, 0.017265, 0.018415, 0.022437, 0.026023, 0.029284, 0.029971, 0.030106, 0.030232, 0.029540, 0.027675, 0.023810, 0.022247, 0.023245, 0.024830, 0.024083, 0.021741, 0.017443, 0.014429, 0.014387, 0.017089, 0.018398, 0.020715, 0.024383
#*# 	  0.010842, 0.008293, 0.008400, 0.012576, 0.016477, 0.020894, 0.023390, 0.023440, 0.023336, 0.023918, 0.024332, 0.022289, 0.019651, 0.015962, 0.014645, 0.015940, 0.015754, 0.011350, 0.006735, 0.002198, 0.001700, 0.004635, 0.006273, 0.010284, 0.013085
#*# 	  0.001755, 0.003133, 0.005064, 0.007589, 0.014330, 0.019418, 0.020195, 0.019720, 0.019286, 0.017439, 0.015961, 0.016982, 0.015699, 0.014825, 0.015076, 0.014888, 0.011926, 0.005685, 0.000815, -0.001315, -0.001339, 0.000577, 0.003376, 0.008522, 0.012829
#*# 	  -0.004554, -0.002989, -0.000893, 0.001862, 0.005226, 0.010869, 0.013947, 0.015474, 0.015661, 0.011891, 0.009651, 0.008539, 0.008999, 0.010790, 0.011156, 0.009940, 0.005725, -0.000458, -0.005507, -0.007947, -0.008673, -0.004947, -0.001093, 0.003157, 0.007167
#*# 	  -0.006982, -0.010064, -0.005965, -0.002358, 0.000869, 0.003811, 0.007907, 0.008195, 0.005965, 0.003831, 0.002730, 0.000372, -0.000685, -0.000014, 0.001276, -0.000674, -0.001954, -0.003789, -0.010116, -0.013221, -0.011550, -0.008436, -0.005001, -0.001881, 0.001058
#*# 	  0.002812, -0.009208, -0.009326, -0.007002, -0.002110, 0.000144, 0.004485, 0.006109, 0.005469, 0.004645, 0.003288, 0.000544, -0.001572, -0.002729, -0.003588, -0.002586, -0.003292, -0.005382, -0.009678, -0.012199, -0.011328, -0.007050, -0.002237, 0.001672, 0.004927
#*# x_count = 25
#*# y_count = 25
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 50.0
#*# max_x = 330.0
#*# min_y = 50.0
#*# max_y = 330.0
#*#
#*# [axis_twist_compensation]
#*# z_compensations = -0.011461, 0.002718, 0.008743
#*# compensation_start_x = 50.0
#*# compensation_end_x = 330.0
#*# zy_compensations = -0.002299, 0.009660, -0.007361
#*# compensation_start_y = 50.0
#*# compensation_end_y = 330.0
