# This file contains common pin mappings for the BIGTREETECH Octopus Max EZ.
# To use this config, the firmware should be compiled for the
# STM32H723 with a "128KiB bootloader", "25 MHz crystal",
# and one of:
# Communication interface: "USB (on PA11/PA12)",
# Communication interface: "CAN bus (on PD0/PD1)", or
# Communication interface: "USB to CAN bus bridge (USB on PA11/PA12))" and CAN bus interface: "CAN bus (on PD0/PD1)".

# See docs/Config_Reference.md for a description of parameters.

#=====================================================
# MACROS
#=====================================================
[include macros.cfg]
[include Fan.cfg]
[include TMC Autotune.cfg]
[exclude_object]
[include TEST_SPEED.cfg]
[include timelapse.cfg]
[include temp_sensors.cfg]
[include z_tilt.cfg]
[include beacon.cfg]
[include LED.cfg]
[include resonance_tester.cfg]
[include input_shaper.cfg]
[include AFC/*.cfg]
#====================================================0=
# VIRTUAL SD CARD
#=====================================================
[include mainsail.cfg]
[virtual_sdcard]
path: /home/pi/printer_data/gcodes

#=====================================================
# MCU ID
#=====================================================
[mcu]
serial: /dev/serial/by-id/usb-Klipper_stm32h723xx_3F003D001051313236343430-if00
[mcu EBBCan]
canbus_uuid: e75929009724
[mcu U2C]
canbus_uuid: 2246f0775ddc

####################################################################
# 	X/Y Stepper Settings
#####################################################################

########################################
# X Stepper on Motor1 (A Motor)
########################################
# Motor-1
[stepper_a]
step_pin: PC13
dir_pin: PC14
enable_pin: !PE6
microsteps: 16
rotation_distance: 40
endstop_pin: EBBCan:PB5
position_endstop: 1
position_max: 377
homing_speed: 150

[tmc5160 stepper_a]
cs_pin: PG14
spi_software_mosi_pin: PE14
spi_software_miso_pin: PE13
spi_software_sclk_pin: PE12
run_current: 1.4
interpolate: false
sense_resistor: 0.075

########################################
# Y Stepper on Motor2 (B Motor)
########################################
# Motor-2
[stepper_b]
step_pin: PE4
dir_pin: PE5
enable_pin: !PE3
microsteps: 16
rotation_distance: 40
endstop_pin: PF0
position_endstop: 370
position_max: 370
homing_speed: 150

[tmc5160 stepper_b]
cs_pin: PG13
spi_software_mosi_pin: PE14
spi_software_miso_pin: PE13
spi_software_sclk_pin: PE12
run_current: 1.4
interpolate: false
sense_resistor: 0.075

########################################
# C Stepper on Motor3 (C Motor)
########################################

[stepper_c]
step_pin: PE1
dir_pin: !PE0
enable_pin: !PE2
microsteps: 16
rotation_distance: 40
position_endstop: 370
position_max: 370
endstop_pin: PF4
homing_speed: 150

[tmc5160 stepper_c]
cs_pin: PG12
spi_software_mosi_pin: PE14
spi_software_miso_pin: PE13
spi_software_sclk_pin: PE12
run_current: 1.4
sense_resistor: 0.075
interpolate: false

########################################
# C1 Stepper on Motor4 (C1 Motor)
########################################

[stepper_c1]
step_pin: PB8
dir_pin: PB9
enable_pin: !PB7
microsteps: 16
rotation_distance: 40

[tmc5160 stepper_c1]
cs_pin: PG11
spi_software_mosi_pin: PE14
spi_software_miso_pin: PE13
spi_software_sclk_pin: PE12
run_current: 1.4
sense_resistor: 0.075
interpolate: false

########################################
# STEPPER Z
########################################
# Motor-5 Front Left
[stepper_z]
step_pin: PB5
dir_pin: PB4
enable_pin: !PB6
endstop_pin: probe:z_virtual_endstop
microsteps: 16
full_steps_per_rotation: 200
rotation_distance: 2
position_max: 400
position_min: -4
homing_speed: 10
homing_retract_dist: 0

[tmc2209 stepper_z]
interpolate: false
uart_pin: PG10
run_current: 1.0
sense_resistor: 0.11


# Motor-6 Front Right 
[stepper_z1] 
step_pin: PG15
dir_pin: PB3
enable_pin: !PD5
microsteps: 16
full_steps_per_rotation: 200
rotation_distance: 2

[tmc2209 stepper_z1]
interpolate: false
uart_pin: PG9
run_current: 1.0
sense_resistor: 0.11

# motor-7 Rear center
[stepper_z2]
step_pin:PD3
dir_pin: PD2
enable_pin: !PD4
microsteps: 16
full_steps_per_rotation: 200
rotation_distance: 2

[tmc2209 stepper_z2]
interpolate: false
uart_pin: PD7
run_current: 1.0
sense_resistor: 0.11

########################################
# EXTRUDER
########################################
[extruder]
step_pin: EBBCan: PD0
dir_pin: !EBBCan: PD1
enable_pin: !EBBCan: PD2
microsteps: 16
rotation_distance: 35.1
gear_ratio: 60:10
nozzle_diameter: 0.400
filament_diameter: 1.750
heater_pin: EBBCan: PB13
sensor_type: MAX31865
pwm_cycle_time: 0.00417
sensor_pin: EBBCan: PA4
spi_bus: spi1
rtd_nominal_r: 100
rtd_reference_r: 430
rtd_num_of_wires: 2
min_extrude_temp: 180
min_temp: 0
max_temp: 400
#control: pid
#pid_Kp: 21.527
#pid_Ki: 1.063
#pid_Kd: 108.982
full_steps_per_rotation: 200
pressure_advance: 0.031
pressure_advance_smooth_time: 0.02
max_extrude_only_distance: 400 

[tmc2209 extruder]
uart_pin: EBBCan: PA15
interpolate: false
run_current: 0.85 
sense_resistor: 0.11 

########################################
# BED MESH
########################################
[bed_mesh]
algorithm: bicubic
speed: 500
mesh_min: 50,50
mesh_max: 330,330
probe_count: 25,25

########################################
# IDLE TIMEOUT
########################################
[idle_timeout]
timeout: 172800

########################################
# HEATER BED
########################################
[heater_bed]
heater_pin: PA0
sensor_pin: PB1 # TB
sensor_type: EPCOS 100K B57560G104F
#control: pid
#pid_kp: 27
#pid_ki: 0.08
#pid_kd: 0
min_temp: 0
max_temp: 120

#=====================================================
# Force Move
#=====================================================
[force_move]
enable_force_move: True

#=====================================================
# PRINTER LIMITS
#=====================================================
[printer]
kinematics: extended_corexy
home_y_axis_with_b_rail : True
max_velocity: 800
max_accel: 10000
max_z_velocity: 10
max_z_accel: 300
square_corner_velocity: 5.0

#[skew_correction]

#=====================================================
# SHAKETUNE
#=====================================================
[shaketune]
# result_folder: ~/printer_data/config/ShakeTune_results
#    Path where the processed results will be stored. If the folder doesn't exist,
#    it will be automatically created. You can change this if you'd like to store 
#    results in a different location.
# number_of_results_to_keep: 10
#    This setting defines how many results you want to keep in the result folder.
#    Once the specified number is exceeded, older results will be automatically deleted
#    to free up space on the SD card and avoid cluttering the results folder.
# keep_raw_data: False
#    If set to True, Shake&Tune will store both the processed graphs and the raw accelerometer
#    .stdata files in the results folder. This can be useful for debugging or archiving purposes.
#    Please always attach them when reporting any issues on GitHub or Discord.
# show_macros_in_webui: True
#    Mainsail and Fluidd doesn't create buttons for system commands (macros that are not part
#    of the printer.cfg file). This option allow Shake&Tune to inject them into the webui at runtime.
#    If set to False, the macros will be hidden but still accessible from the console by typing
#    their names manually, which can be useful if you prefer to encapsulate them into your own macros.
# timeout: 600
#    This defines the maximum processing time (in seconds) to allows to Shake&Tune for generating 
#    graphs from a .stdata file. 10 minutes should be more than enough in most cases, but if you have
#    slower hardware (e.g., older SD cards or low-performance devices), increase it to prevent timeouts.
# measurements_chunk_size: 2
#    Each Shake&Tune command uses the accelerometer to take multiple measurements. By default,
#    Shake&Tune will write a chunk of data to disk every two measurements, and at the end of the
#    command will merge these chunks into the final .stdata file for processing. "2" is a very
#    conservative setting to avoid Klipper Timer Too Close errors on lower end devices with little
#    RAM, and should work for everyone. However, if you are using a powerful computer, you may
#    wish to increase this value to keep more measurements in memory (e.g., 15-20) before writing
#    the chunk and avoid stressing the filesystem too much.
# max_freq: 200
#    This setting defines the maximum frequency at which the calculation of the power spectral density
#    is cutoff. The default value should be fine for most machines and accelerometer combinations and
#    avoid touching it unless you know what you're doing.
# dpi: 300
#    Controls the resolution of the generated graphs. The default value of 300 dpi was optimized
#    and strikes a balance between performance and readability, ensuring that graphs are clear
#    without using too much RAM to generate them. Usually, you shouldn't need to change this value.

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [extruder]
#*# pid_version = 1
#*# pid_target = 290.00
#*# pid_tolerance = 0.0200
#*# control = pid
#*# pid_kp = 19.480
#*# pid_ki = 2.117
#*# pid_kd = 44.807
#*#
#*# [heater_bed]
#*# pid_version = 1
#*# pid_target = 110.00
#*# pid_tolerance = 0.0200
#*# control = pid
#*# pid_kp = 29.333
#*# pid_ki = 0.813
#*# pid_kd = 264.730
#*#
#*# [beacon model default]
#*# model_coef = 1.419558123415431,
#*# 	  1.7686850114972543,
#*# 	  0.7453970433391306,
#*# 	  0.12810793464305015,
#*# 	  0.379438170735937,
#*# 	  1.1342181728267264,
#*# 	  -0.035690162442879904,
#*# 	  -1.1711069614100367,
#*# 	  0.09103925704974984,
#*# 	  0.5435022824725898
#*# model_domain = 1.8043922171165207e-07,1.928660516015101e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 51.443455
#*# model_offset = 0.00000
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  -0.037066, -0.033206, -0.030034, -0.026923, -0.025332, -0.022871, -0.021603, -0.019593, -0.017120, -0.013636, -0.013442, -0.015409, -0.017092, -0.018802, -0.019429, -0.020065, -0.022789, -0.027808, -0.029794, -0.033437, -0.033359, -0.040034, -0.036857, -0.043499, -0.047781
#*# 	  -0.025125, -0.021276, -0.015923, -0.013734, -0.009372, -0.008700, -0.004641, -0.003660, -0.001587, 0.000296, -0.000002, -0.002149, -0.003284, -0.002934, -0.004425, -0.007000, -0.009779, -0.014565, -0.017204, -0.021886, -0.023880, -0.027212, -0.030828, -0.035330, -0.037419
#*# 	  -0.021182, -0.014961, -0.010814, -0.006177, -0.002036, 0.000403, 0.001600, 0.002201, 0.002190, 0.005202, 0.007252, 0.005385, 0.005759, 0.005359, 0.005041, 0.003364, 0.000918, -0.005961, -0.012808, -0.015428, -0.016650, -0.019759, -0.022909, -0.025526, -0.028191
#*# 	  -0.015780, -0.009927, -0.007153, -0.003034, -0.000822, 0.005362, 0.004890, 0.005130, 0.006931, 0.010810, 0.014950, 0.013242, 0.012512, 0.014554, 0.013947, 0.012400, 0.009201, 0.002078, -0.004118, -0.009294, -0.012306, -0.014631, -0.017650, -0.019301, -0.021271
#*# 	  -0.008759, -0.003098, 0.001395, 0.004158, 0.008010, 0.011998, 0.014086, 0.014645, 0.016189, 0.020588, 0.024304, 0.025195, 0.025159, 0.025252, 0.024941, 0.022618, 0.017753, 0.010404, 0.004161, -0.000254, -0.004598, -0.005402, -0.007071, -0.008433, -0.008858
#*# 	  -0.007687, 0.000713, 0.006789, 0.009913, 0.014380, 0.018411, 0.020540, 0.020183, 0.022013, 0.025862, 0.029750, 0.032997, 0.033900, 0.033033, 0.031210, 0.026805, 0.021545, 0.015220, 0.010089, 0.003482, -0.000007, -0.001552, -0.002087, -0.003380, -0.005507
#*# 	  -0.006943, -0.001101, 0.005391, 0.009827, 0.014517, 0.019703, 0.023963, 0.025308, 0.025393, 0.029405, 0.033021, 0.034825, 0.036049, 0.034283, 0.033372, 0.030955, 0.025883, 0.019413, 0.012546, 0.005724, 0.001962, 0.000079, -0.001017, -0.000920, -0.001827
#*# 	  -0.006438, -0.000301, 0.007603, 0.009178, 0.014939, 0.021061, 0.027352, 0.031482, 0.032955, 0.037379, 0.039918, 0.042897, 0.045014, 0.043384, 0.041724, 0.038316, 0.033139, 0.026637, 0.018985, 0.013391, 0.007106, 0.004312, 0.003224, 0.001566, -0.000546
#*# 	  -0.002529, 0.003743, 0.010033, 0.015525, 0.017948, 0.021547, 0.026817, 0.031577, 0.036831, 0.041729, 0.044702, 0.045711, 0.046873, 0.047020, 0.046286, 0.042778, 0.034524, 0.028065, 0.021637, 0.013813, 0.007371, 0.004891, 0.004099, 0.000478, -0.002480
#*# 	  -0.002782, 0.001378, 0.006877, 0.014283, 0.015459, 0.019536, 0.025833, 0.031364, 0.036193, 0.039418, 0.042106, 0.042940, 0.044829, 0.048515, 0.048007, 0.043226, 0.035800, 0.028563, 0.020599, 0.015419, 0.010289, 0.008151, 0.003869, 0.000607, -0.001682
#*# 	  -0.002111, 0.004623, 0.009781, 0.015292, 0.016980, 0.019985, 0.026051, 0.032650, 0.036735, 0.039100, 0.041072, 0.043655, 0.044850, 0.046190, 0.045303, 0.042761, 0.037347, 0.027796, 0.022373, 0.018769, 0.014700, 0.013214, 0.008991, 0.004800, 0.000906
#*# 	  -0.000919, 0.004507, 0.008515, 0.011094, 0.013944, 0.020192, 0.024882, 0.028813, 0.031341, 0.033604, 0.034054, 0.036735, 0.040154, 0.041770, 0.041655, 0.040291, 0.035151, 0.027422, 0.023945, 0.023467, 0.019858, 0.016403, 0.014042, 0.009803, 0.005736
#*# 	  0.000374, 0.003629, 0.005093, 0.009034, 0.013394, 0.018534, 0.023869, 0.027032, 0.029172, 0.029796, 0.030766, 0.031716, 0.033459, 0.033904, 0.035192, 0.034791, 0.030739, 0.024274, 0.020168, 0.018249, 0.013160, 0.010795, 0.007814, 0.004792, 0.001635
#*# 	  -0.008556, -0.005146, -0.003405, -0.001816, 0.004258, 0.010839, 0.020821, 0.025707, 0.026063, 0.025684, 0.027232, 0.028388, 0.027853, 0.027521, 0.028287, 0.027796, 0.024446, 0.020247, 0.013941, 0.009695, 0.007750, 0.007795, 0.006123, 0.002712, -0.001442
#*# 	  -0.008692, -0.005384, -0.004790, -0.003179, 0.002584, 0.013556, 0.021782, 0.026013, 0.027150, 0.026680, 0.028049, 0.029988, 0.030307, 0.030416, 0.032382, 0.033191, 0.028333, 0.020196, 0.013052, 0.008421, 0.002503, 0.001432, 0.000509, -0.002394, -0.005294
#*# 	  -0.010686, -0.009946, -0.008495, -0.004275, 0.002661, 0.014026, 0.022113, 0.025639, 0.026799, 0.023621, 0.023184, 0.025511, 0.026518, 0.027149, 0.028450, 0.029297, 0.025674, 0.017552, 0.009631, 0.003530, -0.001731, -0.003172, -0.002044, -0.003827, -0.006662
#*# 	  -0.019758, -0.018286, -0.016968, -0.012574, -0.005737, 0.004324, 0.013052, 0.018211, 0.018129, 0.016574, 0.017540, 0.019213, 0.020200, 0.021985, 0.022043, 0.020781, 0.018988, 0.013384, 0.004708, -0.003375, -0.009629, -0.011802, -0.013262, -0.015840, -0.017586
#*# 	  -0.026639, -0.024203, -0.020185, -0.014675, -0.006575, 0.003361, 0.010058, 0.014134, 0.014457, 0.014980, 0.015514, 0.016814, 0.018292, 0.017914, 0.016961, 0.016284, 0.012945, 0.006148, -0.002499, -0.008746, -0.015146, -0.018623, -0.020525, -0.022946, -0.025275
#*# 	  -0.028000, -0.024073, -0.017226, -0.010121, -0.001348, 0.006808, 0.009664, 0.015261, 0.018195, 0.018980, 0.019715, 0.020607, 0.019258, 0.020297, 0.020760, 0.019501, 0.014333, 0.008282, 0.001548, -0.004003, -0.011559, -0.015225, -0.016824, -0.020778, -0.024478
#*# 	  -0.032262, -0.027608, -0.020020, -0.014317, -0.006627, 0.000273, 0.005905, 0.011296, 0.015224, 0.016678, 0.018746, 0.017236, 0.015324, 0.013727, 0.014322, 0.012942, 0.010602, 0.005728, -0.001515, -0.009353, -0.013253, -0.015034, -0.018178, -0.022874, -0.026273
#*# 	  -0.041533, -0.036884, -0.029572, -0.020741, -0.013081, -0.005708, -0.000130, 0.004517, 0.006737, 0.010350, 0.012373, 0.012246, 0.009830, 0.006515, 0.004473, 0.003949, 0.001915, -0.006159, -0.013211, -0.021435, -0.024611, -0.027292, -0.030713, -0.034040, -0.037903
#*# 	  -0.050835, -0.042691, -0.035171, -0.026292, -0.016525, -0.008754, -0.004473, -0.000426, 0.002153, 0.002640, 0.003425, 0.005146, 0.005781, 0.004026, 0.003738, 0.001845, -0.002722, -0.011941, -0.020788, -0.025431, -0.029437, -0.031718, -0.034652, -0.035433, -0.039024
#*# 	  -0.057890, -0.050468, -0.042567, -0.032720, -0.027563, -0.018414, -0.012608, -0.006007, -0.003462, -0.003336, -0.004763, -0.003292, -0.002643, -0.000655, -0.000199, -0.004463, -0.009433, -0.017905, -0.026777, -0.033602, -0.037347, -0.038501, -0.039855, -0.042735, -0.044730
#*# 	  -0.063148, -0.058062, -0.046972, -0.038352, -0.033477, -0.026468, -0.019742, -0.014655, -0.014193, -0.013776, -0.013187, -0.013162, -0.012929, -0.012484, -0.012686, -0.014793, -0.019222, -0.024429, -0.032488, -0.039329, -0.042012, -0.042960, -0.045020, -0.047958, -0.051539
#*# 	  -0.056873, -0.061297, -0.050706, -0.047080, -0.037515, -0.032136, -0.025629, -0.019640, -0.016397, -0.015700, -0.016770, -0.016553, -0.018110, -0.017922, -0.019956, -0.020176, -0.023095, -0.027616, -0.034446, -0.041118, -0.043837, -0.044230, -0.043801, -0.046921, -0.050833
#*# x_count = 25
#*# y_count = 25
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 50.0
#*# max_x = 330.0
#*# min_y = 50.0
#*# max_y = 330.0
