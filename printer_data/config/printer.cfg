# This file contains common pin mappings for the BIGTREETECH Octopus Max EZ.
# To use this config, the firmware should be compiled for the
# STM32H723 with a "128KiB bootloader", "25 MHz crystal",
# and one of:
# Communication interface: "USB (on PA11/PA12)",
# Communication interface: "CAN bus (on PD0/PD1)", or
# Communication interface: "USB to CAN bus bridge (USB on PA11/PA12))" and CAN bus interface: "CAN bus (on PD0/PD1)".

# See docs/Config_Reference.md for a description of parameters.

#=====================================================
# MACROS
#=====================================================
[include macros.cfg]
[include Fan.cfg]
[include TMC Autotune.cfg]
[exclude_object]
[include TEST_SPEED.cfg]
[include timelapse.cfg]
[include temp_sensors.cfg]
[include z_tilt.cfg]
[include beacon.cfg]
[include LED.cfg]
[include resonance_tester.cfg]
[include input_shaper.cfg]
[include AFC/*.cfg]
#====================================================0=
# VIRTUAL SD CARD
#=====================================================
[include mainsail.cfg]
[virtual_sdcard]
path: /home/pi/printer_data/gcodes

#=====================================================
# MCU ID
#=====================================================
[mcu]
serial: /dev/serial/by-id/usb-Klipper_stm32h723xx_3F003D001051313236343430-if00
[mcu EBBCan]
canbus_uuid: e75929009724
[mcu U2C]
canbus_uuid: 2246f0775ddc

####################################################################
# 	X/Y Stepper Settings
#####################################################################

########################################
# X Stepper on Motor1 (A Motor)
########################################
# Motor-1
[stepper_a]
step_pin: PC13
dir_pin: PC14
enable_pin: !PE6
microsteps: 16
rotation_distance: 40
endstop_pin: EBBCan:PB5
position_endstop: 1
position_max: 377
homing_speed: 150

[tmc5160 stepper_a]
cs_pin: PG14
spi_software_mosi_pin: PE14
spi_software_miso_pin: PE13
spi_software_sclk_pin: PE12
run_current: 1.4
interpolate: false
sense_resistor: 0.075

########################################
# Y Stepper on Motor2 (B Motor)
########################################
# Motor-2
[stepper_b]
step_pin: PE4
dir_pin: PE5
enable_pin: !PE3
microsteps: 16
rotation_distance: 40
endstop_pin: PF0
position_endstop: 370
position_max: 370
homing_speed: 150

[tmc5160 stepper_b]
cs_pin: PG13
spi_software_mosi_pin: PE14
spi_software_miso_pin: PE13
spi_software_sclk_pin: PE12
run_current: 1.4
interpolate: false
sense_resistor: 0.075

########################################
# C Stepper on Motor3 (C Motor)
########################################

[stepper_c]
step_pin: PE1
dir_pin: !PE0
enable_pin: !PE2
microsteps: 16
rotation_distance: 40
position_endstop: 370
position_max: 370
endstop_pin: PF4
homing_speed: 150

[tmc5160 stepper_c]
cs_pin: PG12
spi_software_mosi_pin: PE14
spi_software_miso_pin: PE13
spi_software_sclk_pin: PE12
run_current: 1.4
sense_resistor: 0.075
interpolate: false

########################################
# C1 Stepper on Motor4 (C1 Motor)
########################################

[stepper_c1]
step_pin: PB8
dir_pin: PB9
enable_pin: !PB7
microsteps: 16
rotation_distance: 40

[tmc5160 stepper_c1]
cs_pin: PG11
spi_software_mosi_pin: PE14
spi_software_miso_pin: PE13
spi_software_sclk_pin: PE12
run_current: 1.4
sense_resistor: 0.075
interpolate: false

########################################
# STEPPER Z
########################################
# Motor-5 Rear Center
[stepper_z]
step_pin: PB5
dir_pin: PB4
enable_pin: !PB6
endstop_pin: probe:z_virtual_endstop
microsteps: 16
full_steps_per_rotation: 200
rotation_distance: 2
position_max: 370
position_min: -4
homing_speed: 10
homing_retract_dist: 0

[tmc2209 stepper_z]
interpolate: false
uart_pin: PG10
run_current: 1.0
sense_resistor: 0.11

# Motor-6 Front Left 
[stepper_z1] 
step_pin: PG15
dir_pin: PB3
enable_pin: !PD5
microsteps: 16
full_steps_per_rotation: 200
rotation_distance: 2

[tmc2209 stepper_z1]
interpolate: false
uart_pin: PG9
run_current: 1.0
sense_resistor: 0.11

# motor-7 Front Right
[stepper_z2]
step_pin:PD3
dir_pin: PD2
enable_pin: !PD4
microsteps: 16
full_steps_per_rotation: 200
rotation_distance: 2

[tmc2209 stepper_z2]
interpolate: false
uart_pin: PD7
run_current: 1.0
sense_resistor: 0.11

########################################
# EXTRUDER
########################################
[extruder]
step_pin: EBBCan: PD0
dir_pin: !EBBCan: PD1
enable_pin: !EBBCan: PD2
microsteps: 16
rotation_distance: 35.1
gear_ratio: 60:10
nozzle_diameter: 0.400
filament_diameter: 1.750
heater_pin: EBBCan: PB13
sensor_type: MAX31865
pwm_cycle_time: 0.00417
sensor_pin: EBBCan: PA4
spi_bus: spi1
rtd_nominal_r: 100
rtd_reference_r: 430
rtd_num_of_wires: 2
min_extrude_temp: 180
min_temp: 0
max_temp: 400
#control: pid
#pid_Kp: 21.527
#pid_Ki: 1.063
#pid_Kd: 108.982
full_steps_per_rotation: 200
pressure_advance: 0.031
pressure_advance_smooth_time: 0.02
max_extrude_only_distance: 400 

[tmc2209 extruder]
uart_pin: EBBCan: PA15
interpolate: false
run_current: 0.85 
sense_resistor: 0.11 
driver_TBL: 0
driver_HEND: 6
driver_HSTRT: 7
driver_TOFF: 4

########################################
# BED MESH
########################################
[bed_mesh]
algorithm: bicubic
speed: 600
mesh_min: 50,50
mesh_max: 330,330
probe_count: 25,25

########################################
# IDLE TIMEOUT
########################################
[idle_timeout]
timeout: 172800

########################################
# HEATER BED
########################################
[heater_bed]
heater_pin: PA0
sensor_pin: PB1 # TB
sensor_type: EPCOS 100K B57560G104F
#control: pid
#pid_kp: 27
#pid_ki: 0.08
#pid_kd: 0
min_temp: 0
max_temp: 120

#=====================================================
# Force Move
#=====================================================
[force_move]
enable_force_move: True

#=====================================================
# PRINTER LIMITS
#=====================================================
[printer]
kinematics: extended_corexy
home_y_axis_with_b_rail : True
max_velocity: 800
max_accel: 10000
max_z_velocity: 10
max_z_accel: 300
square_corner_velocity: 5.0

#[skew_correction]

#=====================================================
# SHAKETUNE
#=====================================================
[shaketune]
# result_folder: ~/printer_data/config/ShakeTune_results
#    Path where the processed results will be stored. If the folder doesn't exist,
#    it will be automatically created. You can change this if you'd like to store 
#    results in a different location.
# number_of_results_to_keep: 10
#    This setting defines how many results you want to keep in the result folder.
#    Once the specified number is exceeded, older results will be automatically deleted
#    to free up space on the SD card and avoid cluttering the results folder.
# keep_raw_data: False
#    If set to True, Shake&Tune will store both the processed graphs and the raw accelerometer
#    .stdata files in the results folder. This can be useful for debugging or archiving purposes.
#    Please always attach them when reporting any issues on GitHub or Discord.
# show_macros_in_webui: True
#    Mainsail and Fluidd doesn't create buttons for system commands (macros that are not part
#    of the printer.cfg file). This option allow Shake&Tune to inject them into the webui at runtime.
#    If set to False, the macros will be hidden but still accessible from the console by typing
#    their names manually, which can be useful if you prefer to encapsulate them into your own macros.
# timeout: 600
#    This defines the maximum processing time (in seconds) to allows to Shake&Tune for generating 
#    graphs from a .stdata file. 10 minutes should be more than enough in most cases, but if you have
#    slower hardware (e.g., older SD cards or low-performance devices), increase it to prevent timeouts.
# measurements_chunk_size: 2
#    Each Shake&Tune command uses the accelerometer to take multiple measurements. By default,
#    Shake&Tune will write a chunk of data to disk every two measurements, and at the end of the
#    command will merge these chunks into the final .stdata file for processing. "2" is a very
#    conservative setting to avoid Klipper Timer Too Close errors on lower end devices with little
#    RAM, and should work for everyone. However, if you are using a powerful computer, you may
#    wish to increase this value to keep more measurements in memory (e.g., 15-20) before writing
#    the chunk and avoid stressing the filesystem too much.
# max_freq: 200
#    This setting defines the maximum frequency at which the calculation of the power spectral density
#    is cutoff. The default value should be fine for most machines and accelerometer combinations and
#    avoid touching it unless you know what you're doing.
# dpi: 300
#    Controls the resolution of the generated graphs. The default value of 300 dpi was optimized
#    and strikes a balance between performance and readability, ensuring that graphs are clear
#    without using too much RAM to generate them. Usually, you shouldn't need to change this value.

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [beacon model default]
#*# model_coef = 1.4058217258871868,
#*# 	  1.7399061434934615,
#*# 	  0.8180035050592912,
#*# 	  0.31669745416078404,
#*# 	  0.18716722830184945,
#*# 	  0.5665178384176669,
#*# 	  0.21496115406833574,
#*# 	  -0.4269441392402592,
#*# 	  -0.026082646132625193,
#*# 	  0.2061674796514033
#*# model_domain = 1.794084567613923e-07,1.926995568352522e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 30.405190
#*# model_offset = 0.00000
#*#
#*# [extruder]
#*# pid_version = 1
#*# pid_target = 290.00
#*# pid_tolerance = 0.0200
#*# control = pid
#*# pid_kp = 19.480
#*# pid_ki = 2.117
#*# pid_kd = 44.807
#*#
#*# [heater_bed]
#*# pid_version = 1
#*# pid_target = 110.00
#*# pid_tolerance = 0.0200
#*# control = pid
#*# pid_kp = 29.333
#*# pid_ki = 0.813
#*# pid_kd = 264.730
#*#
#*# [skew_correction CaliFlower]
#*# xy_skew = -0.003019658965728199
#*# xz_skew = 0.0
#*# yz_skew = 0.0
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	-0.000664, -0.008754, -0.017547, -0.025802, -0.034642, -0.041346, -0.046419, -0.051622, -0.053024, -0.057709, -0.060293, -0.065403, -0.068818, -0.070723, -0.071552, -0.068305, -0.067238, -0.064825, -0.062888, -0.057493, -0.052759, -0.045962, -0.036181, -0.027248, -0.016774
#*# 	0.001666, -0.005582, -0.014070, -0.021178, -0.027653, -0.032454, -0.038722, -0.044529, -0.048999, -0.052379, -0.055966, -0.060584, -0.062707, -0.063657, -0.062984, -0.061360, -0.060848, -0.059507, -0.056300, -0.052104, -0.046752, -0.039748, -0.034000, -0.024051, -0.012259
#*# 	-0.001357, -0.006111, -0.013228, -0.020783, -0.027604, -0.032070, -0.038230, -0.043254, -0.049926, -0.052187, -0.054183, -0.057893, -0.059024, -0.060857, -0.056875, -0.055907, -0.052329, -0.054532, -0.056504, -0.051667, -0.047324, -0.038569, -0.030841, -0.017592, -0.007934
#*# 	-0.002528, -0.007096, -0.013838, -0.023185, -0.030428, -0.034618, -0.040463, -0.047879, -0.050721, -0.052907, -0.052343, -0.055578, -0.056176, -0.054975, -0.054265, -0.052081, -0.051313, -0.052591, -0.052863, -0.050607, -0.045543, -0.037816, -0.028614, -0.017731, -0.006525
#*# 	0.000458, -0.005857, -0.013076, -0.021424, -0.028122, -0.032031, -0.037352, -0.044836, -0.048078, -0.048448, -0.050155, -0.050770, -0.050155, -0.047910, -0.048715, -0.047185, -0.047429, -0.049683, -0.050179, -0.047491, -0.042998, -0.034859, -0.022425, -0.011555, -0.000121
#*# 	-0.003670, -0.007175, -0.013463, -0.020398, -0.027347, -0.031488, -0.035328, -0.042645, -0.047151, -0.047808, -0.047122, -0.046644, -0.046678, -0.046821, -0.046844, -0.047692, -0.047600, -0.049391, -0.049336, -0.048293, -0.043335, -0.034815, -0.022613, -0.011834, -0.000843
#*# 	-0.007713, -0.013776, -0.019690, -0.025416, -0.031061, -0.034088, -0.036682, -0.042279, -0.047935, -0.049095, -0.049546, -0.051043, -0.049961, -0.051270, -0.049614, -0.048661, -0.050486, -0.048944, -0.052196, -0.049831, -0.044889, -0.036794, -0.026538, -0.012793, -0.001017
#*# 	-0.011374, -0.015874, -0.022728, -0.029171, -0.033865, -0.035170, -0.037466, -0.040018, -0.044035, -0.044825, -0.046253, -0.049739, -0.047034, -0.048427, -0.047998, -0.046692, -0.046372, -0.046928, -0.048678, -0.047260, -0.043860, -0.037066, -0.026115, -0.014043, -0.002873
#*# 	-0.009911, -0.014842, -0.021412, -0.026986, -0.034596, -0.038758, -0.041541, -0.043059, -0.044251, -0.042311, -0.046440, -0.047915, -0.049524, -0.048699, -0.046770, -0.045673, -0.048658, -0.049414, -0.048775, -0.049325, -0.046647, -0.038714, -0.027167, -0.015454, -0.005886
#*# 	-0.015073, -0.020046, -0.026381, -0.030895, -0.037852, -0.044046, -0.044639, -0.045858, -0.047277, -0.048133, -0.050112, -0.052211, -0.053731, -0.050432, -0.048902, -0.048788, -0.050734, -0.051737, -0.050467, -0.050492, -0.045536, -0.038399, -0.028439, -0.018501, -0.008043
#*# 	-0.012587, -0.017616, -0.025246, -0.030591, -0.038669, -0.044037, -0.045721, -0.046712, -0.045740, -0.049676, -0.052036, -0.054022, -0.054897, -0.052350, -0.053378, -0.051303, -0.051968, -0.052929, -0.052612, -0.049106, -0.041989, -0.035005, -0.024032, -0.015891, -0.006628
#*# 	-0.010047, -0.016878, -0.025958, -0.035251, -0.041488, -0.044740, -0.046206, -0.049652, -0.052057, -0.054696, -0.059336, -0.059376, -0.056737, -0.056611, -0.055173, -0.052713, -0.053667, -0.055578, -0.052335, -0.043443, -0.036961, -0.029080, -0.020882, -0.012327, -0.002573
#*# 	-0.008415, -0.017046, -0.028775, -0.036948, -0.042049, -0.045507, -0.047485, -0.051304, -0.054470, -0.058956, -0.061351, -0.063907, -0.064471, -0.064526, -0.060645, -0.059145, -0.057506, -0.058752, -0.056783, -0.050356, -0.045535, -0.036181, -0.027772, -0.015559, -0.005893
#*# 	-0.014972, -0.024236, -0.035946, -0.044670, -0.049673, -0.050942, -0.049894, -0.050797, -0.056010, -0.062832, -0.064490, -0.066776, -0.068764, -0.067596, -0.066041, -0.063284, -0.061913, -0.061032, -0.061080, -0.055705, -0.048944, -0.037682, -0.027390, -0.017668, -0.007763
#*# 	-0.014053, -0.022126, -0.034572, -0.044208, -0.047559, -0.044876, -0.042569, -0.047296, -0.052162, -0.056919, -0.061284, -0.062687, -0.062927, -0.062039, -0.059695, -0.055568, -0.054973, -0.056622, -0.057417, -0.056133, -0.050065, -0.041347, -0.029330, -0.018230, -0.008095
#*# 	-0.013273, -0.025274, -0.035409, -0.042874, -0.046072, -0.042290, -0.040751, -0.043031, -0.050199, -0.058115, -0.062780, -0.063852, -0.063568, -0.063512, -0.060391, -0.055200, -0.054532, -0.056699, -0.058516, -0.056880, -0.051187, -0.042775, -0.030177, -0.016740, -0.005528
#*# 	-0.017550, -0.027647, -0.039462, -0.046983, -0.049643, -0.047386, -0.044556, -0.046858, -0.054381, -0.060401, -0.063770, -0.065073, -0.064502, -0.063909, -0.061648, -0.060017, -0.056812, -0.056788, -0.058651, -0.058776, -0.055472, -0.048258, -0.036179, -0.024299, -0.013154
#*# 	-0.019884, -0.028406, -0.037988, -0.042797, -0.045096, -0.042919, -0.043216, -0.046734, -0.051399, -0.056544, -0.059676, -0.061527, -0.061422, -0.061018, -0.061041, -0.058954, -0.058946, -0.056662, -0.059607, -0.059038, -0.056539, -0.049500, -0.037843, -0.026256, -0.014475
#*# 	-0.015669, -0.023682, -0.029588, -0.033386, -0.034465, -0.034593, -0.038403, -0.040603, -0.043130, -0.046493, -0.050039, -0.051313, -0.053250, -0.053036, -0.050713, -0.050378, -0.051029, -0.049057, -0.049802, -0.048432, -0.046314, -0.038876, -0.027916, -0.018559, -0.007334
#*# 	-0.013727, -0.020698, -0.025841, -0.030486, -0.033099, -0.033787, -0.035360, -0.036415, -0.038998, -0.042278, -0.043972, -0.046720, -0.050834, -0.053134, -0.052005, -0.048175, -0.046208, -0.045162, -0.044876, -0.045401, -0.040926, -0.032496, -0.022656, -0.013361, -0.002918
#*# 	-0.014169, -0.022527, -0.029058, -0.030041, -0.031484, -0.032429, -0.033500, -0.036238, -0.038819, -0.040433, -0.042388, -0.044807, -0.047816, -0.052478, -0.052595, -0.049578, -0.047255, -0.047647, -0.049727, -0.049357, -0.044509, -0.035752, -0.027525, -0.016240, -0.006308
#*# 	-0.014899, -0.020390, -0.023845, -0.026427, -0.025985, -0.026347, -0.029242, -0.031645, -0.033843, -0.038497, -0.041295, -0.042271, -0.043233, -0.045973, -0.043363, -0.042664, -0.043070, -0.046145, -0.047750, -0.045481, -0.040052, -0.031648, -0.022737, -0.009940, 0.001421
#*# 	-0.010642, -0.016419, -0.020593, -0.024443, -0.027328, -0.026090, -0.025810, -0.026501, -0.028069, -0.033826, -0.038568, -0.040404, -0.040431, -0.039281, -0.037971, -0.037855, -0.039573, -0.041312, -0.044459, -0.043773, -0.037570, -0.027662, -0.017533, -0.005986, 0.004787
#*# 	-0.005254, -0.012268, -0.015761, -0.018067, -0.021378, -0.021818, -0.022136, -0.022192, -0.028086, -0.033093, -0.035321, -0.039088, -0.040088, -0.038292, -0.038015, -0.037414, -0.037254, -0.035845, -0.037971, -0.037402, -0.030998, -0.020374, -0.010738, -0.000412, 0.009552
#*# 	0.000717, -0.004275, -0.008409, -0.012654, -0.012894, -0.013589, -0.013045, -0.013299, -0.018015, -0.022321, -0.025275, -0.029551, -0.031290, -0.033067, -0.032520, -0.030034, -0.028882, -0.027753, -0.027092, -0.025396, -0.019286, -0.009953, 0.003141, 0.013756, 0.022709
#*# x_count = 25
#*# y_count = 25
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 50.0
#*# max_x = 330.0
#*# min_y = 50.0
#*# max_y = 330.0
